<!DOCTYPE html>
<html lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"stellarkey.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"valine","storage":true,"lazyload":false,"nav":null},"algolia":{"appID":"P1TCRNQBR7","apiKey":"501e087ded257acc9dc481944c14c248","indexName":"云端","hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="IntroductionPython中的Pyspider是用于开发网络爬虫——网上大数据收集工具的一个框架。  收集数据为了下一步大数据处理（机器学习）做准备。">
<meta property="og:type" content="article">
<meta property="og:title" content="Pyspider操作指南">
<meta property="og:url" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/index.html">
<meta property="og:site_name" content="思维之海">
<meta property="og:description" content="IntroductionPython中的Pyspider是用于开发网络爬虫——网上大数据收集工具的一个框架。  收集数据为了下一步大数据处理（机器学习）做准备。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517151058.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517181501.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517202609.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517262931.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517307921.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517347156.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517384491.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517412724.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517430585.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517440890.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517514212.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517523076.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517543155.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517554577.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517571404.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517580505.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517603416.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517620179.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517633446.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517647527.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517661900.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517674126.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517684065.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517695176.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517708754.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517721104.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517730898.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517740901.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517748859.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517832777.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517869728.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517914395.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517964162.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518056366.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518188970.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518206891.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518220976.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518235977.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518252299.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518267613.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518341396.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518359216.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518408683.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518424917.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518436372.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518452136.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518478980.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518500235.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518510194.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518520750.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518539831.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518581682.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518619250.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518648084.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518656810.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518664943.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532514125237.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532514150502.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532514183650.png">
<meta property="og:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532518853415.png">
<meta property="article:published_time" content="2018-07-25T10:11:59.000Z">
<meta property="article:modified_time" content="2021-01-04T14:40:41.216Z">
<meta property="article:author" content="工云">
<meta property="article:tag" content="Pyspider">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="网络爬虫">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/1532517151058.png">

<link rel="canonical" href="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Pyspider操作指南 | 思维之海</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

  <script async defer data-website-id="d07df043-7587-49c8-bc01-ac5ebfdafee5" src="https://stellarkey.asia/umami.js"></script>
<link rel="alternate" href="/atom.xml" title="思维之海" type="application/atom+xml"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">思维之海</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">——在云端，寻找我的星匙。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fas fa-anchor fa-fw"></i> </a>

  </li>
        <li class="menu-item menu-item-life">

    <a href="https://vel.life/" rel="noopener external nofollow noreferrer" target="_blank"><i class="fas fa-star-of-life fa-fw"></i> </a>

  </li>
        <li class="menu-item menu-item-wiki">

    <a href="https://vel.wiki/" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-wikipedia-w fa-fw"></i> </a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fas fa-th fa-fw"></i> </a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fas fa-tags fa-fw"></i> </a>

  </li>
        <li class="menu-item menu-item-link">

    <a href="/link/" rel="section"><i class="fas fa-link fa-fw"></i> </a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fas fa-user fa-fw"></i> </a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>

    
    

    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/stellarkey.gif">
      <meta itemprop="name" content="工云">
      <meta itemprop="description" content="Never stop thinking.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="思维之海">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Pyspider操作指南
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Learn/" itemprop="url" rel="index"><span itemprop="name">Learn</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>Python中的Pyspider是用于<code>开发网络爬虫——网上大数据收集工具</code>的一个框架。</p>
<blockquote>
<p>收集数据为了下一步大数据处理（机器学习）做准备。<span id="more"></span></p>
</blockquote>
<h1 id="初等pyspider操作指南"><a href="#初等pyspider操作指南" class="headerlink" title="初等pyspider操作指南"></a>初等pyspider操作指南</h1><p>原文是在之前学习Pyspider的过程中撰写的，参考了大量资料，这里统一谢过大佬们~</p>
<hr>
<p># 阅读之前假设已经完成以下内容：</p>
<ul>
<li><p><strong>环境已配置</strong></p>
</li>
<li><p><strong>已掌握python的基础概念，如类、对象、库，以及基本语法</strong></p>
</li>
<li><strong>至少已经看过《Python3網絡爬蟲實戰》Youtube视频的第20集</strong></li>
<li>对Mysql/数据库有初步了解，知道什么是html。【咱们的pyspider前处理接口html，后处理接口mysql】</li>
<li>理解并能运用正则表达式，CSS。了解on_start，on_result，index_page，detail_page，crawl，callback…函数（即有哪些参数和它的功能）以及各种常用库的用法，需要时能够合理调用。</li>
<li>推荐的.txt参考资料[网址]已经全部打开浏览过，初等学习撷中1-6个示例程序全部浏览并成功运行和检查。读过pyspider作者的博客，看过官方引导，知道SQLAlchemy，有宏观认识。</li>
</ul>
<p>以上扩展知识均可以在本文的<code>Reference</code>部分找到。</p>
<blockquote>
<p><strong>def Checking(Your_current_stauts):</strong></p>
<p><strong>If</strong> 前三项内容已经全部完成<strong>:</strong></p>
<p><strong>return</strong> 合理的假设 = 你可以<strong>写一个简单的、能运行的爬虫</strong>了。</p>
<p><strong>elif</strong> 全部已完成<strong>:</strong></p>
<p><strong>return</strong> 合理的假设 = 本操作指南的<strong>大部分内容你已能够独自实现</strong>。</p>
<p>​         <strong>else</strong>:</p>
<p>​                   <strong>return</strong> Excuse me???</p>
</blockquote>
<h2 id="实现一个最简单的爬虫"><a href="#实现一个最简单的爬虫" class="headerlink" title="实现一个最简单的爬虫"></a>实现一个最简单的爬虫</h2><p>详情见《Python3網絡爬蟲實戰》Youtube视频的第20集，这里只作简单叙述。（我还是讲一下吧233~~）</p>
<p>再贴一下第20集的网址：</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.youtube.com/watch?v=nHYHdZqDib0&amp;index=20&amp;list=PLlOGeDt-ISLoiX7OyMHYT9t0DOUhL-pxi&amp;t=0s">https://www.youtube.com/watch?v=nHYHdZqDib0&amp;index=20&amp;list=PLlOGeDt-ISLoiX7OyMHYT9t0DOUhL-pxi&amp;t=0s</a></p>
<p>没看的快去看！~~</p>
<p>好的，咳咳，进入正题！</p>
<hr>
<p>我们要实现的<strong>核心功能</strong>如下：</p>
<ul>
<li>正确地获取网页的<strong>内容</strong></li>
<li>实现<strong>翻页</strong></li>
<li>查看<strong>结果</strong></li>
</ul>
<h3 id="搭建框架"><a href="#搭建框架" class="headerlink" title="搭建框架"></a>搭建框架</h3><p>首先创建一个项目：“demo_for_douban”，Start URL(s)这一栏可填可不填，因为它的本质是用来提供信息，好为我们自动创建一个模板。</p>
<p>点击<code>Create</code>。<img data-src="1532517151058.png" alt="1532517151058">                          </p>
<p>接着，打开豆瓣网，进入豆瓣读书，搜索“科幻”。</p>
<p>这便是我们要爬取的索引页。</p>
<p>网址如下：</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://book.douban.com/subject_search?search_text=%E7%A7%91%E5%B9%BB&amp;cat=1001">https://book.douban.com/subject_search?search_text=%E7%A7%91%E5%B9%BB&amp;cat=1001</a></p>
<p><img data-src="1532517181501.png" alt="1532517181501"></p>
<p>​    将<strong>START_URL</strong>改成咱们对应要爬取的网页。（如果Start URL(s)这一栏之前在create的时候已经填了，那么这里会初始化为你填的那个网址哦。） </p>
<p><img data-src="1532517202609.png" alt="1532517202609"></p>
<p>​         单击<code>save</code>。</p>
<p><img data-src="1532517262931.png" alt="1532517262931"></p>
<p>​         从on_start这个初始化的函数，通过：</p>
<p><code>self.crawl(&#39;https://book.douban.com/subject_search?search_text=%E7%A7%91%E5%B9%BB&amp;cat=1001&#39;, callback=self.index_page)</code>这个方法，咱们crawl了咱刚刚填进去的网址，然后把这个网址的内容送（回调）到<strong>index_page</strong>这个函数里面进行进一步解析。</p>
<p><img data-src="1532517307921.png" alt="1532517307921"></p>
<p>​         看到没有！index_page的结构跟on_start函数的结构几乎一毛一样嘛！就是多了一行：</p>
<blockquote>
<p>​         for each in <strong>response.doc(‘a[href^=”http”]’).items()</strong>:</p>
</blockquote>
<p>​         看上去好像是明明白白的英文，不就是对每一个（for each）在……中（in）我去执行下一行的操作——而这个“……”里面的内容不就是<strong>response.doc(‘a[href^=”http”]’).items()</strong>那一串吗？也是<strong>response.doc(‘a[href^=”http”]’)</strong>这个东西的<strong>items()</strong>（项）嘛。</p>
<p>​         回顾一下咱们的任务：</p>
<p><img data-src="1532517347156.png" alt="1532517347156"></p>
<p>​         根据之前crawl的写法，这里可以猜测，each.attr.href应该代表一个网址，这个“.attr.href”后缀肯定就是每一个item()的网址了。它又callback了detail_page，这不是内容页面的意思吗？那就是说，item()的网址肯定是一个内容页面的形式了。</p>
<p>​         这里<strong>重点</strong>讲一下<strong>response.doc(‘a[href^=”http”]’)</strong>的功能，即获取网页上的某个元素。不懂没关系，你只需要知道它是<strong>从网页上获取某些东西</strong>就可以了。</p>
<p>​         咱们要获取的内容页面detail_page是什么呢？如下图中所示。</p>
<p><img data-src="1532517384491.png" alt="1532517384491"></p>
<p>​         我们把每个电影的页面记作内容页面，现在我们尝试获取内容页面的网址。</p>
<p>​         点击Run。</p>
<p><img data-src="1532517412724.png" alt="1532517412724"></p>
<p>​         点击follows。</p>
<p><img data-src="1532517430585.png" alt="1532517430585"></p>
<p>​         点击三角形，执行下一步，</p>
<p><img data-src="1532517440890.png" alt="1532517440890"></p>
<p>​         你会惊喜的发现——</p>
<p>​         hhh</p>
<p>​         报错了。。。。</p>
<p>​         是的。</p>
<p>​         这个错误是由于咱们爬取的网址是https开头而不是http，这时，crawl函数里面必须加入一个参数，<strong>validate_cert=False</strong>。</p>
<p>​         于是正确的姿势应该是下面这样~</p>
<p><img data-src="1532517514212.png" alt="1532517514212"></p>
<p>​         Index_page里面的crawl也要记得添加<strong>validate_cert=False</strong>哦。</p>
<p>​         好了，我们再跑一遍。</p>
<p><img data-src="1532517523076.png" alt="1532517523076"></p>
<p>​         仍然会出现问题哦！！！</p>
<p>​         这里面的原因，其实跟豆瓣这个网址设置了反爬虫机制有关，如果想要爬取豆瓣的信息，就需要更高级的手段，咱目前还达不到，因此只好换个网站~</p>
<p>​         （<strong>讲这里是让大家提前意识到反爬虫以及反反爬虫的技术的重要性</strong>，今后有很多的网站可能有反爬虫的机制，越有名越难爬，大家要有心理准备~）</p>
<p>PS:我会告诉你我懒得改？2333333（逃~</p>
<h3 id="爬取内容"><a href="#爬取内容" class="headerlink" title="爬取内容"></a>爬取内容</h3><p>​             我们换成老记录网，这是一个很好的纪录片的网站哦！安利一下。。。</p>
<p>​         把网址改成：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.laojilu.com/">https://www.laojilu.com/</a></p>
<p><img data-src="1532517543155.png" alt="1532517543155"></p>
<p>​         再次运行，出现detail_page了，出现了125个网址，这些网址有些可能跟我们的需求无关，你看第一个，就是老记录的主页，这个没什么用嘛。我们要爬取的是下面这样的内容网页。</p>
<p><img data-src="1532517554577.png" alt="1532517554577"></p>
<p>​         我们点击Web。如下图。</p>
<p><img data-src="1532517571404.png" alt="1532517571404"></p>
<p>​         可以看到老记录的主页哦。</p>
<p><img data-src="1532517580505.png" alt="1532517580505"></p>
<p>​         是不是有点窄？没关系，咱们调节一下，Chrome中按F12，启动查看元素，点击红圈中的按钮。</p>
<p><img data-src="1532517603416.png" alt="1532517603416"></p>
<p>​         选中视窗。</p>
<p><img data-src="1532517620179.png" alt="1532517620179"></p>
<p>​         更改Style。双击修改宽度150-&gt;450。F11关闭元素查看。好看多了！</p>
<p><img data-src="1532517633446.png" alt="1532517633446"></p>
<p>​         点击enable css选择器按钮。</p>
<p><img data-src="1532517647527.png" alt="1532517647527"></p>
<p>​         选中图中所示的链接，进行CSS选择。可以看到右上角出现了初具雏形的表达式。</p>
<p><img data-src="1532517661900.png" alt="1532517661900"></p>
<p>​         我们点击右上角第一个按钮，复制这个表达式。第二个按钮用来将其插入代码当中。选中index_page里面的a[href^=”http”]表达式，用我们新选择的表达式替换。</p>
<p><img data-src="1532517674126.png" alt="1532517674126"></p>
<p>​         点击save。重新run。</p>
<p><img data-src="1532517684065.png" alt="1532517684065"></p>
<p>​         只剩下一个网页了！！！这可不妙，咱们筛选得好像太过分了。我们重新选择一遍。</p>
<p>​         我们按F11查看一下老记录网主页的Html，并用红圈中的按钮来选择刚刚的元素查看一下它的结构。</p>
<p><img data-src="1532517695176.png" alt="1532517695176"></p>
<p>我们看到结构是这样的，thumbnail类下面，这里面有很多的内容页面，每个保存在h2 &gt; a这样的结构里面。</p>
<p>我们尝试重新做一下CSS表达式。把thumbnail添加进去，点击.tag-79删去这个不必要的说明。</p>
<p><img data-src="1532517708754.png" alt="1532517708754"></p>
<p>​         可以看到，这次页面都被选中了。我们把新的表达式覆盖到代码里面。</p>
<p><img data-src="1532517721104.png" alt="1532517721104"></p>
<p>​         Save，run，看下效果。效果不错哟~~</p>
<p><img data-src="1532517730898.png" alt="1532517730898"></p>
<p>​         随便点一个绿色三角。这里我们点第一个做个示范。</p>
<p><img data-src="1532517740901.png" alt="1532517740901"></p>
<p>​         看！有结果了！分别是title，url的信息。</p>
<p><img data-src="1532517748859.png" alt="1532517748859"></p>
<p>​         这不就是detail_page里面的返回值吗？（这里的返回值是以“键值对”的形式给出的）</p>
<p>​         这就给了为我们一个提示：如果，想要获取更多的信息，可能需要把获得的信息写到return里面。</p>
<p>​         如果想要更多的信息要怎么做呢？</p>
<p>​         照样，重复类似的步骤就行了。我就不详细写了。下面贴出代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># Created on 2018-03-22 01:22:33</span></span><br><span class="line"><span class="comment"># Project: demo_for_douban</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pyspider.libs.base_handler <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handler</span>(<span class="title class_ inherited__">BaseHandler</span>):</span><br><span class="line">    crawl_config = &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">    @every(<span class="params">minutes=<span class="number">24</span> * <span class="number">60</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_start</span>(<span class="params">self</span>):</span><br><span class="line">        self.crawl(<span class="string">&#x27;https://www.laojilu.com/&#x27;</span>,validate_cert=<span class="literal">False</span>, callback=self.index_page)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @config(<span class="params">age=<span class="number">10</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index_page</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> response.doc(<span class="string">&#x27;#thumbnail * &gt; h2 &gt; a&#x27;</span>).items():</span><br><span class="line">            self.crawl(each.attr.href,validate_cert=<span class="literal">False</span>, callback=self.detail_page)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @config(<span class="params">priority=<span class="number">2</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detail_page</span>(<span class="params">self, response</span>):</span><br><span class="line">        </span><br><span class="line">        movie_name = response.doc(<span class="string">&#x27;h1&#x27;</span>).text()</span><br><span class="line">        movie_info = response.doc(<span class="string">&#x27;.post &gt; p&#x27;</span>).text()</span><br><span class="line">        <span class="comment">#如果要对info进一步分离，可采用items()分别获取，再存入对应的元素</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: response.url,</span><br><span class="line">            <span class="string">&quot;title&quot;</span>: response.doc(<span class="string">&#x27;title&#x27;</span>).text(),</span><br><span class="line">            <span class="string">&quot;movie_name&quot;</span>: movie_name,</span><br><span class="line">            <span class="string">&quot;movie_info&quot;</span>: movie_info,</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>​         以及运行的抓取结果：（抓取图片的技术比较复杂，可以看demo中的实现方法）</p>
<p><img data-src="1532517832777.png" alt="1532517832777"></p>
<h3 id="结果展示"><a href="#结果展示" class="headerlink" title="结果展示"></a>结果展示</h3><p>再回顾一下咱们最开始的目的~~</p>
<p><img data-src="1532517869728.png" alt="1532517869728"></p>
<p>​         咱们已经实现了前后的内容和结果，可是翻页操作还没实现呢！这可要命，没有翻页操作的话，爬完这一页，下一页不就不能爬了？</p>
<p>​         这里要设计一个index_page的循环。我获取这一页索引的内容页之后，能够转到下一页索引，继续获取新的内容页。</p>
<p>​         添加两行代码，获取下一页的链接。</p>
<p><img data-src="1532517914395.png" alt="1532517914395"></p>
<p>​         再run一遍，发现follows从18个分支，变成了19个，多了个index_page。这便实现了翻页操作。</p>
<p><img data-src="1532517964162.png" alt="1532517964162"></p>
<p>给出一个总的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># Created on 2018-03-22 01:22:33</span></span><br><span class="line"><span class="comment"># Project: demo_for_douban</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pyspider.libs.base_handler <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handler</span>(<span class="title class_ inherited__">BaseHandler</span>):</span><br><span class="line">    crawl_config = &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">    @every(<span class="params">minutes=<span class="number">24</span> * <span class="number">60</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_start</span>(<span class="params">self</span>):</span><br><span class="line">        self.crawl(<span class="string">&#x27;https://www.laojilu.com/&#x27;</span>,validate_cert=<span class="literal">False</span>, callback=self.index_page)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @config(<span class="params">age=<span class="number">10</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index_page</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> response.doc(<span class="string">&#x27;#thumbnail * &gt; h2 &gt; a&#x27;</span>).items():</span><br><span class="line">            self.crawl(each.attr.href,validate_cert=<span class="literal">False</span>, callback=self.detail_page)</span><br><span class="line">        <span class="built_in">next</span> = response.doc(<span class="string">&#x27;.next&#x27;</span>)</span><br><span class="line">        self.crawl(<span class="built_in">next</span>.attr.href,validate_cert=<span class="literal">False</span>,callback=self.index_page)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @config(<span class="params">priority=<span class="number">2</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detail_page</span>(<span class="params">self, response</span>):</span><br><span class="line">        </span><br><span class="line">        movie_name = response.doc(<span class="string">&#x27;h1&#x27;</span>).text()</span><br><span class="line">        movie_info = response.doc(<span class="string">&#x27;.post &gt; p&#x27;</span>).text()</span><br><span class="line">        <span class="comment">#如果要对info进一步分离，可采用items()分别获取，再存入对应的元素</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: response.url,</span><br><span class="line">            <span class="string">&quot;title&quot;</span>: response.doc(<span class="string">&#x27;title&#x27;</span>).text(),</span><br><span class="line">            <span class="string">&quot;movie_name&quot;</span>: movie_name,</span><br><span class="line">            <span class="string">&quot;movie_info&quot;</span>: movie_info,</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>当然，我们最终的目的是要将爬取的结果保存到本地嘛。</p>
<p>我们借助demo里面改写的on_result方法，Tool工具类，以及一系列的库和附加的初始化定义（比如定义图片存储路径的DIR_PATH），就能很方便地实现了！这里就不再作更具体的描述了，留给你练练手吧~</p>
<h2 id="CSS选择器的简单回顾"><a href="#CSS选择器的简单回顾" class="headerlink" title="CSS选择器的简单回顾"></a>CSS选择器的简单回顾</h2><p>​    <strong>注意：以下内容是基于你“至少已经看过《Python3網絡爬蟲實戰》Youtube视频的第20集”。</strong></p>
<h3 id="什么是CSS选择器"><a href="#什么是CSS选择器" class="headerlink" title="什么是CSS选择器"></a>什么是CSS选择器</h3><p>在pyspider的WebUI上，可以看到五大功能：</p>
<p><img data-src="1532518056366.png" alt="1532518056366"></p>
<p>按重要程度分别是：</p>
<ul>
<li><code>Follows</code>，用于单步调试【可在本指南的如何DEBUG的常用方法中找到更详细的描述】</li>
<li><code>Web</code>，网页，在这里运行到某一步，可查看对应的页面（pyspider的本质是自动地浏览网页，并把网页的内容有选择性地下载下来）</li>
<li><code>Enable css selector helper</code>，CSS选择器。通常与网页的html结合起来使用，这样获得的CSS表达式往往更准确</li>
</ul>
<p>使用方法：见《Python3網絡爬蟲實戰》Youtube视频的第20集</p>
<ul>
<li><code>Message</code>，消息（队列），不常用</li>
<li><code>Html</code>，不常用</li>
</ul>
<h3 id="抓取合适的CSS"><a href="#抓取合适的CSS" class="headerlink" title="抓取合适的CSS"></a>抓取合适的CSS</h3><p>通常通过pyspider的WebUI提供的CSS选择器，我们已经可以很方便地抓取大部分的网页内容。但是仍然有少量的内容可能出现一些问题，这时咱们可以借助Chrome自带的网页元素查看器，进行更细致准确的分析。</p>
<ul>
<li>比较常出现的情况是：<strong>表达式含义不唯一</strong>。比如抓取content，可能一个content对应了好多个元素a，那么这时就要用到正则表达式了。</li>
</ul>
<h3 id="最简单的正则表达式"><a href="#最简单的正则表达式" class="headerlink" title="最简单的正则表达式"></a>最简单的正则表达式</h3><p>咱们一般会用的正则表达式（我目前遇到的）有且仅有一种。</p>
<p>就是  .xxx &gt; xxx &gt; xxx<strong>[“XYZ=ABC”]</strong> 的形式。</p>
<p>在我之前给大家的“4. for<em>compositesworld(复合材料世界)</em>基于JEC通用化代码模板_改进版”里，有下面一行代码：</p>
<p><img data-src="1532518188970.png" alt="1532518188970"></p>
<p>这就是典型的应用。大家可以按照之前的方法查看一下对应的网页元素，弄清楚为什么这么做。【提示：使<strong>表达式的含义唯一</strong>】</p>
<h2 id="结构化、伪宏控制"><a href="#结构化、伪宏控制" class="headerlink" title="结构化、伪宏控制"></a>结构化、伪宏控制</h2><h3 id="伪宏控制"><a href="#伪宏控制" class="headerlink" title="伪宏控制"></a>伪宏控制</h3><p>学过C语言的你，可能还记得C语言中有一种功能：宏定义。</p>
<p><img data-src="1532518206891.png" alt="1532518206891"></p>
<p>C++中宏定义能够实现类似下面这个示例代码的功能：</p>
<p><img data-src="1532518220976.png" alt="1532518220976"></p>
<p>可以看到，预先定义的宏可以在接下来的整个程序的任何地方，只要写它的名字就行了。该也非常方便，因为你只用改宏pi，整个程序的pi就能随之而变。</p>
<p>尽管python中没有严格的宏的功能，但我们通过预先把需要调节的参数统一命名赋值，放置到程序的头部，还是可以实现的。这样，咱们的代码就能实现结构化了！</p>
<p>对于同样一种结构的网页，我们使用同一套代码的输入模板就能很方便地修改对应参数，快速编程了。</p>
<h3 id="范式编程"><a href="#范式编程" class="headerlink" title="范式编程"></a>范式编程</h3><p>范式就是典型的意思。咱们可以通过一个比较具有代表性的网站的爬取框架，进行范式化。但这个框架的使用一定具有一些条件，这些要在代码中写明。</p>
<p><img data-src="1532518235977.png" alt="1532518235977"></p>
<p>接下来咱们就能动手实现范式化的编程了。</p>
<p>效果如图。</p>
<p><img data-src="1532518252299.png" alt="1532518252299"></p>
<p>​         具体过程我就不详细解释了，如果前面的理解没有问题，这里应该不难。你也可以尝试动手实现自己的一个范式哦~</p>
<h2 id="封装与自动化"><a href="#封装与自动化" class="headerlink" title="封装与自动化"></a>封装与自动化</h2><h3 id="自动化创建子目录"><a href="#自动化创建子目录" class="headerlink" title="自动化创建子目录"></a>自动化创建子目录</h3><p>细心的你可能已经发现：咱们理论上虽然可以在WebUI/dashboard上一次建立很多个爬虫程序，但是——所有的图片好像都保存在了同一个路径之下？？？What？还有这种操作？那我保存的图片管理起来岂不是非常混乱……</p>
<p>于是可能会有这样的想法……</p>
<p>如果能够在子目录里面，按照我建的project的名字创建一个专属于这个project的子文件夹，那么张三的文件放到张三的文件夹里，李四的文件放到李四的文件夹里，管理起来岂不是方便多了，而且还很直观。这就是核心的想法。</p>
<p>基于这样的想法，我们对DIR_PATH这个图片保存目录做以下的修改：</p>
<p><img data-src="1532518267613.png" alt="1532518267613"></p>
<p>​    （也许你在疑惑我是用了什么主题的IDLE才有这么酷炫的编程界面？？？那么注意啦，这是Sublime Text 3，非常适合小项目的编程IDE。你可以百度搜索下载哦，只要进行一定的快捷设置，就可以实现在Sublime Text 3进行python程序的运行~具体问度娘~）</p>
<p>整个思路就是：创建一个项目子目录，如果目录不存在。</p>
<p>下面我们尝试创建两个项目。在cmd命令行粘贴以下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd desktop</span><br><span class="line">md CraData</span><br><span class="line">cd CraData</span><br><span class="line">pyspider all</span><br></pre></td></tr></table></figure>
<p>如果成功运行，桌面上将出现一个CraData文件，用于保存爬取的数据。</p>
<p>效果如图：</p>
<p><img data-src="1532518341396.png" alt="1532518341396"></p>
<p>在WebUI创建两个项目JEC和Comp，分别把</p>
<p><strong>3.</strong> <strong>封装<em>for_jeccomposites(JEC)</em>**</strong>伪宏控制__<strong>**范式编程.py</strong></p>
<p>和</p>
<p><strong>4. for<em>compositesworld(复合材料世界)</em>基于JEC通用化代码模板_改进版.py</strong></p>
<p>中的代码覆盖到项目的代码中。如下图所示：</p>
<p><img data-src="1532518359216.png" alt="1532518359216"></p>
<p>回到dashboard，将两个项目的状态都调到running，点击run。</p>
<p>打开图片存放的目录，发现有两个基于project_name生成的子文件夹：</p>
<p><img data-src="1532518408683.png" alt="1532518408683"></p>
<p>说明运行成功。</p>
<h3 id="封装——create-table方法的实现"><a href="#封装——create-table方法的实现" class="headerlink" title="封装——create_table方法的实现"></a>封装——create_table方法的实现</h3><p>打开mysqldb_new.py文件。</p>
<p>看第三行：</p>
<p><img data-src="1532518424917.png" alt="1532518424917"></p>
<p>使用该改进方法可能需要安装的库：sqlalchemy，mysql-connector。均可用pip install快速安装。这说明你必须首先安装这两个库，才能使用这个基于mysqldb的改进库。</p>
<p>让我们看看它与mysqldb有什么不同。</p>
<p><img data-src="1532518436372.png" alt="1532518436372"></p>
<p><img data-src="1532518452136.png" alt="1532518452136"></p>
<p>可以看到，它的区别主要在于前面引入了三个新库，尾部增加了一个create_table方法。</p>
<p>具体的实现方法就不细讲了，网上可以百度。要使用这个库，把它拷贝到与mysqldb相同的目录下即可。注意需要在</p>
<p>engine = create_engine(‘mysql+mysqlconnector://root:fdzxks@localhost:3307/pyspider’)</p>
<p>​    这一行进行数据库的连接设置才能正常使用。</p>
<p>下面讲一下怎么调用它。</p>
<p><img data-src="1532518478980.png" alt="1532518478980"></p>
<p>可以看到，方法里面有两个参数，self，project_name，self是class（类）对象自带的一个默认参数，必须要填，你可以不用管它。project_name参数则比较重要，顾名思义，就是你的项目的名字。如果你已经实现过前面的范式编程，你应该对这个变量名很熟悉。以下是一个调用的实例：</p>
<p>打开之前发过的文件：</p>
<p>\6. test<em>pro</em>通过调用MySQLnew实现自动创建列表_demo.py</p>
<p><img data-src="1532518500235.png" alt="1532518500235"></p>
<p>Run一下。打开Navicat，发现有新的表格自动建立了。【必须先保证前面数据库连接参数已设定好】</p>
<p><img data-src="1532518510194.png" alt="1532518510194"></p>
<p>右键选择“设计表”查看表结构。</p>
<p><img data-src="1532518520750.png" alt="1532518520750"></p>
<p>与咱们需要的表结构一致。运行成功。</p>
<p>PS：test_for_auto_table_maker是一个名字，你可以任意指定/修改。</p>
<h3 id="自动化创建表"><a href="#自动化创建表" class="headerlink" title="自动化创建表"></a>自动化创建表</h3><p>首先咱们需要在代码中加入两个部分：<img data-src="1532518539831.png" alt="1532518539831"></p>
<p>然后就能够自动创建表了。【但你首先要完成之前的步骤哦】</p>
<h3 id="代码重用"><a href="#代码重用" class="headerlink" title="代码重用"></a>代码重用</h3><p>聪明的你也许已经发现了，到现在为止，咱们的demo代码里面，还有两大块我没有提到过。它们是：</p>
<p><img data-src="1532518581682.png" alt="1532518581682"></p>
<p>​    和</p>
<p><img data-src="1532518619250.png" alt="1532518619250"></p>
<p>​    这两个部分，一个用来初始化，一个用来定义工具类，都是咱们可以直接调用的方法，它们的存在，更类似于库，只不过没有封装成一个库用import引进来而已。因此，咱们不用太关注里面具体是如何实现的，你只需要知道它的功能，需要输入什么，能够输出什么，就足够了。而这些，代码中的注释应该能给你一定的启发。如果还有问题，随时百度哦。</p>
<h2 id="如何DEBUG？"><a href="#如何DEBUG？" class="headerlink" title="如何DEBUG？"></a>如何DEBUG？</h2><h3 id="DEBUG是什么"><a href="#DEBUG是什么" class="headerlink" title="DEBUG是什么"></a>DEBUG是什么</h3><p>DEBUG是什么，首先要知道BUG是什么，即“虫子”（虫族？？），计算机学中用来指代程序、代码的漏洞。例如，在长达上亿行代码的window操作系统中，漏洞的数量也是非常多的，成千上万。BUG是非常难以彻底避免，对于大型的项目，甚至有相关的指标规定：如，千行代码缺陷率（bug率）。</p>
<p>只要代码是人写的，出错的原因一定在自身。【这里已经默认你已经完成了环境的部署哦，如果环境设置没弄好而出现的问题不属于这里的讨论范围~】那么，就要找找自己的原因了，是否对程序的框架不够清楚就匆忙开始写？是否了解自己代码的功能？是否考虑过可能出现的代码BUG，并作一定的预防措施（“可以理解”的报错）？</p>
<p>假若，木已成舟，生米已经熟饭……<strong>DEBUG**</strong>——程序纠错、调试<strong>就不可避免了。一般来说，质量越差的源代码，调试起来就越困难，耗费的时间也就越长，BUG更加难以识别，甚至天长地久也不能发现。</strong>提高源代码质量的方法：加注释，结构化，封装化**。</p>
<h3 id="常用方法总结"><a href="#常用方法总结" class="headerlink" title="常用方法总结"></a>常用方法总结</h3><p>下面介绍Pyspider的三种常用的DEBUG方法：</p>
<h4 id="l-使用单步调试"><a href="#l-使用单步调试" class="headerlink" title="l  使用单步调试"></a>l  使用单步调试</h4><p>打开host:5000页面，pyspider dashboard，进入一个project。</p>
<p>之前我们用的点击绿色小三角来单步执行，就是单步调试。不细讲了。</p>
<p>如果你已经实现了往数据库传输结果，在这个阶段请你先屏蔽掉on_result方法，让结果能直接显示在WebUI网页里面，便于分析结果抓取是否合理。</p>
<p>屏蔽掉on_result方法即在对应代码行最前加注释号（或者直接先删掉该方法，之后再粘贴进来）：</p>
<p><img data-src="1532518648084.png" alt="1532518648084"></p>
<h4 id="l-使用命令行调试"><a href="#l-使用命令行调试" class="headerlink" title="l  使用命令行调试"></a>l  使用命令行调试</h4><p>修改项目status到running，点击run。</p>
<p><img data-src="1532518656810.png" alt="1532518656810"></p>
<p>在命令行会发现下面这样的效果：</p>
<p><img data-src="1532518664943.png" alt="1532518664943"></p>
<p>你会发现最左边的字母，一般只会出现两种状态：“I”和“E”。</p>
<p>“I”我不知道是什么意思，但“E”经我推测应该代表Error的意思。如果你的命令行在运行过程中出现了“E”，请按照给出的错误信息进行调试。</p>
<p>比如我现在就出现了这样的错误：</p>
<p>ValueError(u’String does not contain a date:’, ‘’)</p>
<p>这说明抓取的time里面，有的date（日期）没有抓取下来，字符串是空的，可能需要做一些修改（比如尝试更精确CSS表达式，或者更好地对提取的time做处理）。</p>
<p>一般这里的错误单步调试时理论上也能找到，但由于咱们爬取的页面数量庞大，有些错误还是要依靠命令行来查找。</p>
<h4 id="l-使用前后接口调试"><a href="#l-使用前后接口调试" class="headerlink" title="l  使用前后接口调试"></a>l  使用前后接口调试</h4><p>pyspider前接口，对接网页即html；pyspider后接口，对接数据库即mysql。</p>
<p>Html影响获取内容，mysql影响储存信息。</p>
<p>Html的调试，就是选择合适的CSS表达式的过程。</p>
<p>Mysql的调试，查看是否存入数据，数据是否规范等。</p>
<p>已经，对图片保存目录进行查看，是否成功爬取图片。</p>
<h3 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h3><p>如果time(调试) &gt;&gt; time(写代码)，说明源代码质量差，要注意提高代码质量；如果time(写代码)+ time(调试) &gt;&gt; time (average)，说明基本功不好，要多练。</p>
<p>强调：写代码一定要高质量，否则调试很麻烦。</p>
<p>这是惨痛的经验<del>~</del></p>
<h3 id="彩蛋"><a href="#彩蛋" class="headerlink" title="彩蛋"></a>彩蛋</h3><p>试试运行以下代码？【先运行pip install turtle】</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Run完会不会想起球状闪电——&gt;……？？？</span></span><br><span class="line"><span class="keyword">from</span> turtle <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"> </span><br><span class="line">setup(<span class="number">600</span>,<span class="number">800</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">speed(<span class="number">0</span>)</span><br><span class="line">penup()</span><br><span class="line">seth(<span class="number">90</span>)</span><br><span class="line">fd(<span class="number">340</span>)</span><br><span class="line">seth(<span class="number">0</span>)</span><br><span class="line">pendown()</span><br><span class="line"> </span><br><span class="line">speed(<span class="number">5</span>)</span><br><span class="line">begin_fill()</span><br><span class="line">fillcolor(<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">circle(<span class="number">50</span>,<span class="number">30</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    fd(<span class="number">1</span>)</span><br><span class="line">    left(<span class="number">10</span>)</span><br><span class="line"> </span><br><span class="line">circle(<span class="number">40</span>,<span class="number">40</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    fd(<span class="number">1</span>)</span><br><span class="line">    left(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line">circle(<span class="number">80</span>,<span class="number">40</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    fd(<span class="number">0.5</span>)</span><br><span class="line">    left(<span class="number">5</span>)</span><br><span class="line"> </span><br><span class="line">circle(<span class="number">80</span>,<span class="number">45</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    fd(<span class="number">2</span>)</span><br><span class="line">    left(<span class="number">1</span>)</span><br><span class="line">     </span><br><span class="line">circle(<span class="number">80</span>,<span class="number">25</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    fd(<span class="number">1</span>)</span><br><span class="line">    left(<span class="number">4</span>)</span><br><span class="line"> </span><br><span class="line">circle(<span class="number">50</span>,<span class="number">50</span>)</span><br><span class="line"> </span><br><span class="line">time.sleep(<span class="number">0.1</span>)</span><br><span class="line"> </span><br><span class="line">circle(<span class="number">120</span>,<span class="number">55</span>)</span><br><span class="line"> </span><br><span class="line">speed(<span class="number">0</span>)</span><br><span class="line"> </span><br><span class="line">seth(-<span class="number">90</span>)</span><br><span class="line">fd(<span class="number">70</span>)</span><br><span class="line"> </span><br><span class="line">right(<span class="number">150</span>)</span><br><span class="line">fd(<span class="number">20</span>)</span><br><span class="line"> </span><br><span class="line">left(<span class="number">140</span>)</span><br><span class="line">circle(<span class="number">140</span>,<span class="number">90</span>)</span><br><span class="line"> </span><br><span class="line">left(<span class="number">30</span>)</span><br><span class="line">circle(<span class="number">160</span>,<span class="number">100</span>)</span><br><span class="line"> </span><br><span class="line">left(<span class="number">130</span>)</span><br><span class="line">fd(<span class="number">25</span>)</span><br><span class="line"> </span><br><span class="line">penup()</span><br><span class="line">right(<span class="number">150</span>)</span><br><span class="line">circle(<span class="number">40</span>,<span class="number">80</span>)</span><br><span class="line">pendown()</span><br><span class="line"> </span><br><span class="line">left(<span class="number">115</span>)</span><br><span class="line">fd(<span class="number">60</span>)</span><br><span class="line"> </span><br><span class="line">penup()</span><br><span class="line">left(<span class="number">180</span>)</span><br><span class="line">fd(<span class="number">60</span>)</span><br><span class="line">pendown()</span><br><span class="line"> </span><br><span class="line">end_fill()</span><br><span class="line"> </span><br><span class="line">right(<span class="number">120</span>)</span><br><span class="line">circle(-<span class="number">50</span>,<span class="number">50</span>)</span><br><span class="line">circle(-<span class="number">20</span>,<span class="number">90</span>)</span><br><span class="line"> </span><br><span class="line">speed(<span class="number">1</span>)</span><br><span class="line">fd(<span class="number">75</span>)</span><br><span class="line"> </span><br><span class="line">speed(<span class="number">0</span>)</span><br><span class="line">circle(<span class="number">90</span>,<span class="number">110</span>)</span><br><span class="line"> </span><br><span class="line">penup()</span><br><span class="line">left(<span class="number">162</span>)</span><br><span class="line">fd(<span class="number">185</span>)</span><br><span class="line">left(<span class="number">170</span>)</span><br><span class="line">pendown()</span><br><span class="line">circle(<span class="number">200</span>,<span class="number">10</span>)</span><br><span class="line">circle(<span class="number">100</span>,<span class="number">40</span>)</span><br><span class="line">circle(-<span class="number">52</span>,<span class="number">115</span>)</span><br><span class="line">left(<span class="number">20</span>)</span><br><span class="line">circle(<span class="number">100</span>,<span class="number">20</span>)</span><br><span class="line">circle(<span class="number">300</span>,<span class="number">20</span>)</span><br><span class="line">speed(<span class="number">1</span>)</span><br><span class="line">fd(<span class="number">250</span>)</span><br><span class="line"> </span><br><span class="line">penup()</span><br><span class="line">speed(<span class="number">0</span>)</span><br><span class="line">left(<span class="number">180</span>)</span><br><span class="line">fd(<span class="number">250</span>)</span><br><span class="line">circle(-<span class="number">300</span>,<span class="number">7</span>)</span><br><span class="line">right(<span class="number">80</span>)</span><br><span class="line">circle(<span class="number">200</span>,<span class="number">5</span>)</span><br><span class="line">pendown()</span><br><span class="line"> </span><br><span class="line">left(<span class="number">60</span>)</span><br><span class="line">begin_fill()</span><br><span class="line">fillcolor(<span class="string">&#x27;green&#x27;</span>)</span><br><span class="line">circle(-<span class="number">80</span>,<span class="number">100</span>)</span><br><span class="line">right(<span class="number">90</span>)</span><br><span class="line">fd(<span class="number">10</span>)</span><br><span class="line">left(<span class="number">20</span>)</span><br><span class="line">circle(-<span class="number">63</span>,<span class="number">127</span>)</span><br><span class="line">end_fill()</span><br><span class="line"> </span><br><span class="line">penup()</span><br><span class="line">left(<span class="number">50</span>)</span><br><span class="line">fd(<span class="number">20</span>)</span><br><span class="line">left(<span class="number">180</span>)</span><br><span class="line"> </span><br><span class="line">pendown()</span><br><span class="line">circle(<span class="number">200</span>,<span class="number">25</span>)</span><br><span class="line"> </span><br><span class="line">penup()</span><br><span class="line">right(<span class="number">150</span>)</span><br><span class="line"> </span><br><span class="line">fd(<span class="number">180</span>)</span><br><span class="line"> </span><br><span class="line">right(<span class="number">40</span>)</span><br><span class="line">pendown()</span><br><span class="line">begin_fill()</span><br><span class="line">fillcolor(<span class="string">&#x27;green&#x27;</span>)</span><br><span class="line">circle(-<span class="number">100</span>,<span class="number">80</span>)</span><br><span class="line">right(<span class="number">150</span>)</span><br><span class="line">fd(<span class="number">10</span>)</span><br><span class="line">left(<span class="number">60</span>)</span><br><span class="line">circle(-<span class="number">80</span>,<span class="number">98</span>)</span><br><span class="line">end_fill()</span><br><span class="line"> </span><br><span class="line">penup()</span><br><span class="line">left(<span class="number">60</span>)</span><br><span class="line">fd(<span class="number">13</span>)</span><br><span class="line">left(<span class="number">180</span>)</span><br><span class="line"> </span><br><span class="line">pendown()</span><br><span class="line">speed(<span class="number">1</span>)</span><br><span class="line">circle(-<span class="number">200</span>,<span class="number">23</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">exitonclick()</span><br></pre></td></tr></table></figure>
<p>参考自：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.cnblogs.com/wwh8797/p/7739699.html">https://www.cnblogs.com/wwh8797/p/7739699.html</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.zhihu.com/question/21664179">https://www.zhihu.com/question/21664179</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.bugman123.com/index.html">http://www.bugman123.com/index.html</a></p>
<h1 id="Pyspider环境配置"><a href="#Pyspider环境配置" class="headerlink" title="Pyspider环境配置"></a>Pyspider环境配置</h1><p>Pyspider的介绍等请读者自行搜索知悉。</p>
<p>Pyspider的框架搭建过程并不唯一，高级读者可以自行决定。</p>
<p>一些参考资料，可在本文的<code>Reference</code>中找到。</p>
<h2 id="Python2框架"><a href="#Python2框架" class="headerlink" title="Python2框架"></a>Python2框架</h2><ol>
<li>安装python2.7（32位，64位对pyspider支持有问题，相关软件文件夹中直接双击安装即可，注意选择添加环境变量，否则后面需要手动添加环境变量）</li>
<li>Microsoft Visual C++ Compiler for Python 2.7安装（相关软件文件夹中直接双击安装VCForPython27.msi）</li>
<li>安装pyspider</li>
</ol>
<blockquote>
<p>Cmd执行pip install pyspider安装（如果没有pip，可以将C:\Python27;C:\Python27\Scripts两个路径添加到环境变量即可）</p>
<p>安装过程中可能会遇到一些依赖无法安装，需要手动下载安装包。到这个链接网址<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.lfd.uci.edu/~gohlke/pythonlibs/">https://www.lfd.uci.edu/~gohlke/pythonlibs/</a>，搜索相应版本的安装包，下载，pip install <em>**</em>.whl即可</p>
</blockquote>
<ol>
<li>Mysql数据库连接设置<ol>
<li>本机装好数据库</li>
<li>将相关软件中mysqldb.py文件拷贝到安装路径C:\Python27\Lib\site-packages\pyspider\database\mysql\下,打开文件修改相关数据库连接参数：                               </li>
</ol>
</li>
</ol>
<p><img data-src="1532514125237.png" alt="1532514125237"></p>
<ol>
<li>Cmd切换到开发目录下输入pyspider启动，这个目录可以随意见一个，之后在页面写的脚本都会保存在这个目录下。</li>
</ol>
<h2 id="Anaconda框架"><a href="#Anaconda框架" class="headerlink" title="Anaconda框架"></a>Anaconda框架</h2><p>基本操作如上，但Anaconda<strong>支持多环境的切换</strong>（比如，py2和py3），更方便。</p>
<p>并且Anaconda会<strong>自动安装常用的库</strong>，对新手更友好。</p>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p>下面介绍一个demo</p>
<blockquote>
<p>先在mysql建好数据库表：</p>
</blockquote>
<p><img data-src="1532514150502.png" alt="1532514150502"></p>
<blockquote>
<p>打开浏览器输入<a target="_blank" rel="noopener external nofollow noreferrer" href="http://localhost:5000/">http://localhost:5000/</a>，单击create创建爬虫脚本(以爬取美国波音公司媒体网站<a target="_blank" rel="noopener external nofollow noreferrer" href="http://boeing.mediaroom.com/为例">http://boeing.mediaroom.com/为例</a>)</p>
</blockquote>
<p>输入：</p>
<blockquote>
<p><code>project name：boeing</code></p>
<p><code>url：http://boeing.mediaroom.com/</code></p>
</blockquote>
<p>创建之后将以下内容拷贝到右侧代码框中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># Created on 2017-12-05 20:59:56</span></span><br><span class="line"><span class="comment"># Project: boeing</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pyspider.libs.base_handler <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> pyspider.database.mysql.mysqldb <span class="keyword">import</span> SQL</span><br><span class="line"><span class="keyword">import</span> sys  </span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time <span class="keyword">as</span> ti</span><br><span class="line"><span class="keyword">from</span> dateutil <span class="keyword">import</span> parser</span><br><span class="line">  </span><br><span class="line">reload(sys)  </span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#图片存放目录</span></span><br><span class="line">DIR_PATH = <span class="string">&quot;./&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handler</span>(<span class="title class_ inherited__">BaseHandler</span>):</span><br><span class="line">    </span><br><span class="line">    headers= &#123;</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>:<span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>:<span class="string">&quot;gzip, deflate, sdch&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Language&quot;</span>:<span class="string">&quot;zh-CN,zh;q=0.8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Cache-Control&quot;</span>:<span class="string">&quot;max-age=0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Connection&quot;</span>:<span class="string">&quot;keep-alive&quot;</span>,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.101 Safari/537.36&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    crawl_config = &#123;</span><br><span class="line">        <span class="string">&#x27;itag&#x27;</span>: <span class="string">&#x27;v1.1&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;headers&quot;</span> : headers,</span><br><span class="line">        <span class="string">&quot;timeout&quot;</span> : <span class="number">100000</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.dir_path = DIR_PATH</span><br><span class="line">        self.tool = Tool()</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @every(<span class="params">minutes=<span class="number">24</span> * <span class="number">60</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_start</span>(<span class="params">self</span>):</span><br><span class="line">        self.crawl(<span class="string">&#x27;http://boeing.mediaroom.com/news-releases-statements&#x27;</span>, callback=self.index_page)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @config(<span class="params">age=<span class="number">10</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index_page</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> response.doc(<span class="string">&#x27;.archive_nav &gt; a&#x27;</span>).items():</span><br><span class="line">            year=each.text()</span><br><span class="line">            <span class="keyword">if</span>(year != <span class="string">&quot;Search&quot;</span>):</span><br><span class="line">                <span class="keyword">if</span>(year==<span class="string">&quot;2016&quot;</span> <span class="keyword">or</span> year==<span class="string">&quot;2015&quot;</span>):</span><br><span class="line">                    self.crawl(each.attr.href, callback=self.news_page)</span><br><span class="line">                </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">news_page</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> response.doc(<span class="string">&#x27;.item&#x27;</span>).items():</span><br><span class="line">            time=each.find(<span class="string">&#x27;div&#x27;</span>).eq(<span class="number">0</span>).text()</span><br><span class="line">            datetime_struct = parser.parse(time)</span><br><span class="line">            time=datetime_struct.strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)</span><br><span class="line">            self.crawl(each.find(<span class="string">&#x27;div&#x27;</span>).find(<span class="string">&#x27;a&#x27;</span>).attr.href, save=&#123;<span class="string">&#x27;time&#x27;</span>: time&#125;,callback=self.news,connect_timeout = <span class="number">5000</span>, timeout = <span class="number">20000</span>)</span><br><span class="line">        <span class="keyword">for</span> each_page <span class="keyword">in</span> response.doc(<span class="string">&#x27;.table_footer &gt; b &gt; a&#x27;</span>).items():</span><br><span class="line">            self.crawl(each_page.attr.href, callback=self.news_page2)</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">news_page2</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> response.doc(<span class="string">&#x27;.item&#x27;</span>).items():</span><br><span class="line">            time=each.find(<span class="string">&#x27;div&#x27;</span>).eq(<span class="number">0</span>).text()</span><br><span class="line">            datetime_struct = parser.parse(time)</span><br><span class="line">            time=datetime_struct.strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)</span><br><span class="line">            self.crawl(each.find(<span class="string">&#x27;div&#x27;</span>).find(<span class="string">&#x27;a&#x27;</span>).attr.href, save=&#123;<span class="string">&#x27;time&#x27;</span>: time&#125;,callback=self.news,connect_timeout = <span class="number">5000</span>, timeout = <span class="number">20000</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">news</span>(<span class="params">self, response</span>):</span><br><span class="line">        time=response.save[<span class="string">&#x27;time&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> response.doc(<span class="string">&#x27;#assets_20295_130083-117_tab_link&#x27;</span>):</span><br><span class="line">            self.crawl(response.doc(<span class="string">&#x27;#assets_20295_130083-117_tab_link&#x27;</span>).attr.href,save=&#123;<span class="string">&#x27;time&#x27;</span>: time&#125;, callback=self.detail_page,validate_cert=<span class="literal">False</span>,connect_timeout = <span class="number">5000</span>, timeout = <span class="number">20000</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.crawl(response.url, save=&#123;<span class="string">&#x27;time&#x27;</span>: time&#125;,callback=self.detail_page,validate_cert=<span class="literal">False</span>,connect_timeout = <span class="number">5000</span>, timeout = <span class="number">20000</span>)</span><br><span class="line">        </span><br><span class="line"><span class="meta">    @config(<span class="params">priority=<span class="number">2</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detail_page</span>(<span class="params">self, response</span>):</span><br><span class="line">        title=response.doc(<span class="string">&#x27;.wd_news_releases-detail &gt; h1&#x27;</span>).text()</span><br><span class="line">        time=response.save[<span class="string">&#x27;time&#x27;</span>]</span><br><span class="line">        content = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> response.doc(<span class="string">&#x27;.news_body &gt; p&#x27;</span>).items():</span><br><span class="line">            content += each.text()</span><br><span class="line">        url = response.url</span><br><span class="line">        picture_url = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        picture_local_path = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        file_title = re.sub(<span class="string">&#x27;[\/:*?&quot;&lt;&gt;|]&#x27;</span>,<span class="string">&#x27;-&#x27;</span>,title)</span><br><span class="line">        imgDir = self.dir_path</span><br><span class="line">        <span class="keyword">for</span> imgElem <span class="keyword">in</span> response.doc(<span class="string">&#x27;.detail_image &gt; img&#x27;</span>).items():</span><br><span class="line">            imgUrl = imgElem.attr.src</span><br><span class="line">            picture_url += imgUrl + <span class="string">&#x27;;&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> imgUrl:</span><br><span class="line">                <span class="comment">#获取图片文件后缀</span></span><br><span class="line">                extension = self.tool.get_extension(imgUrl)</span><br><span class="line">                name = self.tool.get_name(imgUrl)</span><br><span class="line">                <span class="comment">#拼接图片名</span></span><br><span class="line">                file_name = name + <span class="string">&quot;.&quot;</span> + extension</span><br><span class="line">                picture_local_path += <span class="string">&#x27;;&#x27;</span> + file_name</span><br><span class="line">                self.crawl(imgUrl,callback=self.save_img,save=&#123;<span class="string">&quot;file_name&quot;</span>:file_name, <span class="string">&quot;imgDir&quot;</span>:imgDir&#125;,validate_cert=<span class="literal">False</span>, connect_timeout = <span class="number">5000</span>, timeout = <span class="number">20000</span>)</span><br><span class="line">                </span><br><span class="line">        <span class="keyword">for</span> imgElem <span class="keyword">in</span> response.doc(<span class="string">&#x27;.PRN_ImbeddedAssetReference &gt; p &gt; img&#x27;</span>).items():</span><br><span class="line">            imgUrl = imgElem.attr.src</span><br><span class="line">            picture_url += imgUrl + <span class="string">&#x27;;&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> imgUrl:</span><br><span class="line">                <span class="comment">#获取图片文件后缀</span></span><br><span class="line">                extension = self.tool.get_extension(imgUrl)</span><br><span class="line">                name = self.tool.get_name(imgUrl)</span><br><span class="line">                <span class="comment">#拼接图片名</span></span><br><span class="line">                file_name = name + <span class="string">&quot;.&quot;</span> + extension</span><br><span class="line">                picture_local_path += <span class="string">&#x27;;&#x27;</span> + file_name</span><br><span class="line">                self.crawl(imgUrl,callback=self.save_img,save=&#123;<span class="string">&quot;file_name&quot;</span>:file_name, <span class="string">&quot;imgDir&quot;</span>:imgDir&#125;,validate_cert=<span class="literal">False</span>, connect_timeout = <span class="number">5000</span>, timeout = <span class="number">30000</span>)   </span><br><span class="line">                </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;title&quot;</span>:title,</span><br><span class="line">            <span class="string">&quot;introduction&quot;</span>:<span class="string">&quot;null&quot;</span>,</span><br><span class="line">            <span class="string">&quot;time&quot;</span>:time,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>:content,</span><br><span class="line">            <span class="string">&quot;keywords&quot;</span>:<span class="string">&quot;null&quot;</span>,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>:<span class="string">&quot;boeing&quot;</span>,</span><br><span class="line">            <span class="string">&quot;source&quot;</span>:<span class="string">&quot;原创&quot;</span>,</span><br><span class="line">            <span class="string">&quot;url&quot;</span>:url,</span><br><span class="line">            <span class="string">&quot;picture_url&quot;</span>:picture_url,</span><br><span class="line">            <span class="string">&quot;picture_local_path&quot;</span>:picture_local_path</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#保存图片</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_img</span>(<span class="params">self,response</span>):</span><br><span class="line">        content = response.content</span><br><span class="line">        file_name = response.save[<span class="string">&quot;file_name&quot;</span>]</span><br><span class="line">        imgDir = response.save[<span class="string">&quot;imgDir&quot;</span>]</span><br><span class="line">        file_path = imgDir + file_name</span><br><span class="line">        self.tool.save_img(content,imgDir,file_path)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_result</span>(<span class="params">self,result</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> result <span class="keyword">or</span> <span class="keyword">not</span> result[<span class="string">&#x27;title&#x27;</span>]:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        sql = SQL()</span><br><span class="line">        sql.insert(<span class="string">&#x27;boeing&#x27;</span>,**result)</span><br><span class="line">        </span><br><span class="line"><span class="comment">#工具类    </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tool</span>:</span><br><span class="line">    <span class="comment">#保存图片</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_img</span>(<span class="params">self,content,imgDir,path</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(imgDir):                         </span><br><span class="line">            os.makedirs(imgDir)</span><br><span class="line">        f = <span class="built_in">open</span>(path,<span class="string">&quot;wb&quot;</span> )</span><br><span class="line">        f.write(content)</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取url后缀名</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_extension</span>(<span class="params">self,url</span>):                            </span><br><span class="line">        extension = url.split(<span class="string">&quot;.&quot;</span>)[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> extension </span><br><span class="line">    </span><br><span class="line">    <span class="comment">#获取图片名</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_name</span>(<span class="params">self,url</span>):</span><br><span class="line">        name=url.split(<span class="string">&quot;/&quot;</span>)[-<span class="number">1</span>].split(<span class="string">&quot;.&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> name</span><br></pre></td></tr></table></figure>
<ul>
<li>单击save</li>
<li>回到pyspider dashboard页面</li>
<li>修改状态到running，单击run。查询数据库是否有数据写入。</li>
</ul>
<p><img data-src="1532514183650.png" alt="1532514183650"></p>
<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h1><h2 id="python学习资料"><a href="#python学习资料" class="headerlink" title="python学习资料"></a>python学习资料</h2><p>初学者不建议直接安装python！请安装Anaconda！<br>Anaconda能省去很多装各种库的麻烦，而且还能非常方便地配置多环境（如Python2.7+Python3.6，2.7用来爬虫，3.6用来接轨新技术）。</p>
<ol>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="http://blog.csdn.net/qiushi_1990/article/details/78041375">http://blog.csdn.net/qiushi_1990/article/details/78041375</a><br> Python人工智能之图片识别，Python3一行代码实现图片文字识别</li>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="http://idea.lanyus.com/">http://idea.lanyus.com/</a><br> Professional版Pycharm注册码获得，也可直接使用免费的社区版</li>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.jetbrains.com/pycharm/download/download-thanks.html?platform=windows">https://www.jetbrains.com/pycharm/download/download-thanks.html?platform=windows</a><br> PycharmIDE官网的引导视频（Pycharm更多用于项目开发吧，写个小程序的话还是推荐用sublime text或者原装的IDLE哦）</li>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.zhihu.com/question/29238666">https://www.zhihu.com/question/29238666</a><br> 如何写一个简单的手写识别算法？——知乎</li>
<li>推荐：[计算机][Python实战：四周实现爬虫系统][中文][SWF] 。（我没看多少）</li>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="http://blog.csdn.net/u012162613/article/details/41929171">http://blog.csdn.net/u012162613/article/details/41929171</a><br> 大数据竞赛平台——Kaggle 入门</li>
<li>不贴网址了。网上搜中国大学MOOC嵩天老师的Python相关课程，从基础到各个方向都有。B站也可以看哦。</li>
</ol>
<h2 id="pyspider学习资料"><a href="#pyspider学习资料" class="headerlink" title="pyspider学习资料"></a>pyspider学习资料</h2><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://binux.blog/">https://binux.blog/</a><br>​    pyspider作者（疑似作者？）的博客，有详细的指导。（叙述比较有框架）<br><a target="_blank" rel="noopener external nofollow noreferrer" href="http://docs.pyspider.org/en/latest/tutorial/HTML-and-CSS-Selector/#index-page">http://docs.pyspider.org/en/latest/tutorial/HTML-and-CSS-Selector/#index-page</a><br>​    pyspider的官方引导（内容跟上一条差不多）<br><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.youtube.com/playlist?list=PLlOGeDt-ISLoiX7OyMHYT9t0DOUhL-pxi">https://www.youtube.com/playlist?list=PLlOGeDt-ISLoiX7OyMHYT9t0DOUhL-pxi</a><br>​    标题：Python3網絡爬蟲實戰<br>​    非常棒的视频教程！有pyspider的使用指南视频，在教程的20、21集。有简单的一个爬虫框架的实现，强烈建议观看！（无须翻墙，清晰度有点感人。。）<br><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.bilibili.com/video/av5354244?from=search&amp;seid=3687842734548943914">https://www.bilibili.com/video/av5354244?from=search&amp;seid=3687842734548943914</a><br>​    标题：【Mysql】从删库到跑路（全20讲）<br>​    B站Mysql的基础讲解，建议不熟悉数据库的话，可以先看前面5、6节，喜欢可以接着学~<br><a target="_blank" rel="noopener external nofollow noreferrer" href="http://demo.pyspider.org/">http://demo.pyspider.org/</a><br>​    pyspider的各种示例程序demo，可以在线运行（不用启动pyspider？）<br><a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.pyspider.cn/jiaocheng/pyspider-pyquery-14.html">http://www.pyspider.cn/jiaocheng/pyspider-pyquery-14.html</a><br>​    pyspider中内容选择器常用方法汇总（各种函数的调用规则）<br><a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.pyspider.cn/index.html">http://www.pyspider.cn/index.html</a><br>​    pyspider中文官方网站<br><a target="_blank" rel="noopener external nofollow noreferrer" href="http://blog.csdn.net/i_chaoren/article/details/62264414">http://blog.csdn.net/i_chaoren/article/details/62264414</a><br><a target="_blank" rel="noopener external nofollow noreferrer" href="http://blog.csdn.net/zaifendou/article/details/5746988">http://blog.csdn.net/zaifendou/article/details/5746988</a><br><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.cnblogs.com/darkterror/p/6474211.html">https://www.cnblogs.com/darkterror/p/6474211.html</a><br>​    正则表达式基础详解<br><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.bilibili.com/video/av5862916?from=search&amp;seid=6989261257840462106">https://www.bilibili.com/video/av5862916?from=search&amp;seid=6989261257840462106</a><br>​    html语言的一点背景知识，最好了解一点<br><a target="_blank" rel="noopener external nofollow noreferrer" href="http://blog.csdn.net/FeiSan/article/details/1887677">http://blog.csdn.net/FeiSan/article/details/1887677</a><br>​    SQLAlchemy下定义MySQL特有的字段类型<br><a target="_blank" rel="noopener external nofollow noreferrer" href="http://blog.csdn.net/u012827296/article/details/51236614">http://blog.csdn.net/u012827296/article/details/51236614</a><br>​    Handler运行机制</p>
<h2 id="pyspider快捷启动命令"><a href="#pyspider快捷启动命令" class="headerlink" title="pyspider快捷启动命令"></a>pyspider快捷启动命令</h2><p>！pyspider快捷启动命令_为了提高cmd运行速度，直接在txt中修改，然后Ctrl+A粘贴到cmd中执行_cd到目录_md创建目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">F:</span><br><span class="line">md Crawl_data\demo</span><br><span class="line">cd Crawl_data\demo</span><br><span class="line">activate python2</span><br><span class="line">pyspider all</span><br></pre></td></tr></table></figure>
<h2 id="可能会用到的安装包"><a href="#可能会用到的安装包" class="headerlink" title="可能会用到的安装包"></a>可能会用到的安装包</h2><p>只提供明细，不提供下载。</p>
<p><img data-src="1532518853415.png" alt="1532518853415"></p>
<h2 id="迷之·附录-代码"><a href="#迷之·附录-代码" class="headerlink" title="迷之·附录(代码)"></a>迷之·附录(代码)</h2><p>代码集中车间233。</p>
<h3 id="代码：结构-model-for-crawl-demo加注释版-py"><a href="#代码：结构-model-for-crawl-demo加注释版-py" class="headerlink" title="代码：结构_model_for_crawl_demo加注释版.py"></a>代码：结构_model_for_crawl_demo加注释版.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#爬取模板:加注释版</span></span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># Created on 2017-12-05 20:59:56</span></span><br><span class="line"><span class="comment"># Project: boeing</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pyspider.libs.base_handler <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> pyspider.database.mysql.mysqldb <span class="keyword">import</span> SQL</span><br><span class="line"><span class="keyword">import</span> sys  </span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time <span class="keyword">as</span> ti</span><br><span class="line"><span class="keyword">from</span> dateutil <span class="keyword">import</span> parser</span><br><span class="line">  </span><br><span class="line">reload(sys)  </span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#图片存放目录</span></span><br><span class="line">DIR_PATH = <span class="string">&quot;./&quot;</span>  <span class="comment"># pyspider默认目录？</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handler</span>(<span class="title class_ inherited__">BaseHandler</span>):</span><br><span class="line">    </span><br><span class="line">    headers= &#123;</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>:<span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>:<span class="string">&quot;gzip, deflate, sdch&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Language&quot;</span>:<span class="string">&quot;zh-CN,zh;q=0.8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Cache-Control&quot;</span>:<span class="string">&quot;max-age=0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Connection&quot;</span>:<span class="string">&quot;keep-alive&quot;</span>,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.101 Safari/537.36&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    crawl_config = &#123;</span><br><span class="line">        <span class="string">&#x27;itag&#x27;</span>: <span class="string">&#x27;v1.1&#x27;</span>,</span><br><span class="line">        <span class="string">&quot;headers&quot;</span> : headers,</span><br><span class="line">        <span class="string">&quot;timeout&quot;</span> : <span class="number">100000</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.dir_path = DIR_PATH</span><br><span class="line">        self.tool = Tool()</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @every(<span class="params">minutes=<span class="number">24</span> * <span class="number">60</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_start</span>(<span class="params">self</span>):				<span class="comment">#这里设置你要爬取的网页，先登录看看是否对应，否则容易出错</span></span><br><span class="line">        self.crawl(<span class="string">&#x27;http://boeing.mediaroom.com/news-releases-statements&#x27;</span>, callback=self.index_page)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @config(<span class="params">age=<span class="number">10</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index_page</span>(<span class="params">self, response</span>):				<span class="comment">#设置索引页</span></span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> response.doc(<span class="string">&#x27;.archive_nav &gt; a&#x27;</span>).items():</span><br><span class="line">            year=each.text()</span><br><span class="line">            <span class="keyword">if</span>(year != <span class="string">&quot;Search&quot;</span>):</span><br><span class="line">                <span class="keyword">if</span>(year==<span class="string">&quot;2016&quot;</span> <span class="keyword">or</span> year==<span class="string">&quot;2015&quot;</span>):			<span class="comment">#这里设置爬取网页新闻的年份（按年份分类），最好把最新的年份都爬取下来【注意，不是所有的网站都有这个分类！】</span></span><br><span class="line">                    self.crawl(each.attr.href, callback=self.news_page)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#进入某一年份的index页面            </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">news_page</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> response.doc(<span class="string">&#x27;.item&#x27;</span>).items():</span><br><span class="line">            time=each.find(<span class="string">&#x27;div&#x27;</span>).eq(<span class="number">0</span>).text()          <span class="comment"># find&#x27;div&#x27;是找到.item下的所有元素，然后eq(0)获取第0个（首个）元素的text()，即内容</span></span><br><span class="line">            datetime_struct = parser.parse(time)</span><br><span class="line">            time=datetime_struct.strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)   <span class="comment"># 这里的功能是，将网页代表时间的字符串格式化为%Y-%m-%d（原网页是英文格式）</span></span><br><span class="line">            self.crawl(each.find(<span class="string">&#x27;div&#x27;</span>).find(<span class="string">&#x27;a&#x27;</span>).attr.href, save=&#123;<span class="string">&#x27;time&#x27;</span>: time&#125;,callback=self.news,connect_timeout = <span class="number">5000</span>, timeout = <span class="number">20000</span>)    <span class="comment">#调取新闻页。注意，所有的time都是提前在index页获取的，因此需要传递给最后的处理函数</span></span><br><span class="line">        <span class="keyword">for</span> each_page <span class="keyword">in</span> response.doc(<span class="string">&#x27;.table_footer &gt; b &gt; a&#x27;</span>).items():</span><br><span class="line">            self.crawl(each_page.attr.href, callback=self.news_page2)   <span class="comment">#调取其它新闻页</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#基于该年份，调取其它index页（一个年份可能对应多个index页面，一个index页面又对应多个新闻页）       </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">news_page2</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> response.doc(<span class="string">&#x27;.item&#x27;</span>).items():</span><br><span class="line">            time=each.find(<span class="string">&#x27;div&#x27;</span>).eq(<span class="number">0</span>).text()  <span class="comment">#同理，以下</span></span><br><span class="line">            datetime_struct = parser.parse(time)</span><br><span class="line">            time=datetime_struct.strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)</span><br><span class="line">            self.crawl(each.find(<span class="string">&#x27;div&#x27;</span>).find(<span class="string">&#x27;a&#x27;</span>).attr.href, save=&#123;<span class="string">&#x27;time&#x27;</span>: time&#125;,callback=self.news,connect_timeout = <span class="number">5000</span>, timeout = <span class="number">20000</span>)    <span class="comment"># each.find(&#x27;div&#x27;).find(&#x27;a&#x27;).attr.href是获得新闻页的url</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#主方法，进入新闻页</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">news</span>(<span class="params">self, response</span>):</span><br><span class="line">        time=response.save[<span class="string">&#x27;time&#x27;</span>]  <span class="comment">#记录已经格式化的时间，继续往下传递</span></span><br><span class="line">        <span class="keyword">if</span> response.doc(<span class="string">&#x27;#assets_20295_130083-117_tab_link&#x27;</span>):   <span class="comment"># 这里的if else是用来判断新闻有无图片</span></span><br><span class="line">            self.crawl(response.doc(<span class="string">&#x27;#assets_20295_130083-117_tab_link&#x27;</span>).attr.href,save=&#123;<span class="string">&#x27;time&#x27;</span>: time&#125;, callback=self.detail_page,validate_cert=<span class="literal">False</span>,connect_timeout = <span class="number">5000</span>, timeout = <span class="number">20000</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.crawl(response.url, save=&#123;<span class="string">&#x27;time&#x27;</span>: time&#125;,callback=self.detail_page,validate_cert=<span class="literal">False</span>,connect_timeout = <span class="number">5000</span>, timeout = <span class="number">20000</span>)</span><br><span class="line">        </span><br><span class="line"><span class="meta">    @config(<span class="params">priority=<span class="number">2</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detail_page</span>(<span class="params">self, response</span>):</span><br><span class="line">        title=response.doc(<span class="string">&#x27;.wd_news_releases-detail &gt; h1&#x27;</span>).text()  <span class="comment">#通过正则表达式获取新闻题目</span></span><br><span class="line">        time=response.save[<span class="string">&#x27;time&#x27;</span>]  <span class="comment">#最终获取到时间</span></span><br><span class="line">        content = <span class="string">&#x27;&#x27;</span>    <span class="comment">#初始化新闻内容为空，字符串</span></span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> response.doc(<span class="string">&#x27;.news_body &gt; p&#x27;</span>).items():  <span class="comment"># 对于每一个在.news_body &gt; p中的内容都添加到content中</span></span><br><span class="line">            content += each.text()</span><br><span class="line">        url = response.url      <span class="comment"># 保存网址为当前网址</span></span><br><span class="line">        picture_url = <span class="string">&#x27;&#x27;</span>    <span class="comment">#与content同理</span></span><br><span class="line">        picture_local_path = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        file_title = re.sub(<span class="string">&#x27;[\/:*?&quot;&lt;&gt;|]&#x27;</span>,<span class="string">&#x27;-&#x27;</span>,title)    <span class="comment"># ？？？某个正则表达式？</span></span><br><span class="line">        imgDir = self.dir_path</span><br><span class="line"> <span class="comment">#处理图片的方法1：</span></span><br><span class="line">        <span class="keyword">for</span> imgElem <span class="keyword">in</span> response.doc(<span class="string">&#x27;.detail_image &gt; img&#x27;</span>).items():</span><br><span class="line">            imgUrl = imgElem.attr.src</span><br><span class="line">            picture_url += imgUrl + <span class="string">&#x27;;&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> imgUrl:</span><br><span class="line">                <span class="comment">#获取图片文件后缀</span></span><br><span class="line">                extension = self.tool.get_extension(imgUrl)</span><br><span class="line">                name = self.tool.get_name(imgUrl)</span><br><span class="line">                <span class="comment">#拼接图片名</span></span><br><span class="line">                file_name = name + <span class="string">&quot;.&quot;</span> + extension</span><br><span class="line">                picture_local_path += <span class="string">&#x27;;&#x27;</span> + file_name</span><br><span class="line">                self.crawl(imgUrl,callback=self.save_img,save=&#123;<span class="string">&quot;file_name&quot;</span>:file_name, <span class="string">&quot;imgDir&quot;</span>:imgDir&#125;,validate_cert=<span class="literal">False</span>, connect_timeout = <span class="number">5000</span>, timeout = <span class="number">20000</span>)</span><br><span class="line">  <span class="comment">#处理图片的方法2：               </span></span><br><span class="line">        <span class="keyword">for</span> imgElem <span class="keyword">in</span> response.doc(<span class="string">&#x27;.PRN_ImbeddedAssetReference &gt; p &gt; img&#x27;</span>).items():</span><br><span class="line">            imgUrl = imgElem.attr.src</span><br><span class="line">            picture_url += imgUrl + <span class="string">&#x27;;&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> imgUrl:</span><br><span class="line">                <span class="comment">#获取图片文件后缀</span></span><br><span class="line">                extension = self.tool.get_extension(imgUrl)</span><br><span class="line">                name = self.tool.get_name(imgUrl)</span><br><span class="line">                <span class="comment">#拼接图片名</span></span><br><span class="line">                file_name = name + <span class="string">&quot;.&quot;</span> + extension</span><br><span class="line">                picture_local_path += <span class="string">&#x27;;&#x27;</span> + file_name</span><br><span class="line">                self.crawl(imgUrl,callback=self.save_img,save=&#123;<span class="string">&quot;file_name&quot;</span>:file_name, <span class="string">&quot;imgDir&quot;</span>:imgDir&#125;,validate_cert=<span class="literal">False</span>, connect_timeout = <span class="number">5000</span>, timeout = <span class="number">30000</span>)   </span><br><span class="line">                </span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;title&quot;</span>:title,</span><br><span class="line">            <span class="string">&quot;introduction&quot;</span>:<span class="string">&quot;null&quot;</span>,</span><br><span class="line">            <span class="string">&quot;time&quot;</span>:time,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>:content,</span><br><span class="line">            <span class="string">&quot;keywords&quot;</span>:<span class="string">&quot;null&quot;</span>,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>:<span class="string">&quot;boeing&quot;</span>,      <span class="comment">#这里根据你建的表格名修改</span></span><br><span class="line">            <span class="string">&quot;source&quot;</span>:<span class="string">&quot;原创&quot;</span>,</span><br><span class="line">            <span class="string">&quot;url&quot;</span>:url,</span><br><span class="line">            <span class="string">&quot;picture_url&quot;</span>:picture_url,</span><br><span class="line">            <span class="string">&quot;picture_local_path&quot;</span>:picture_local_path</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#保存图片</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_img</span>(<span class="params">self,response</span>):</span><br><span class="line">        content = response.content</span><br><span class="line">        file_name = response.save[<span class="string">&quot;file_name&quot;</span>]</span><br><span class="line">        imgDir = response.save[<span class="string">&quot;imgDir&quot;</span>]</span><br><span class="line">        file_path = imgDir + file_name</span><br><span class="line">        self.tool.save_img(content,imgDir,file_path)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_result</span>(<span class="params">self,result</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> result <span class="keyword">or</span> <span class="keyword">not</span> result[<span class="string">&#x27;title&#x27;</span>]:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        sql = SQL()</span><br><span class="line">        sql.insert(<span class="string">&#x27;boeing&#x27;</span>,**result)       <span class="comment">#这里也要对应修改哦</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">#工具类    </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tool</span>:</span><br><span class="line">    <span class="comment">#保存图片</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_img</span>(<span class="params">self,content,imgDir,path</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(imgDir):                         </span><br><span class="line">            os.makedirs(imgDir)</span><br><span class="line">        f = <span class="built_in">open</span>(path,<span class="string">&quot;wb&quot;</span> )        <span class="comment">#写入文件</span></span><br><span class="line">        f.write(content)</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取url后缀名</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_extension</span>(<span class="params">self,url</span>):                            </span><br><span class="line">        extension = url.split(<span class="string">&quot;.&quot;</span>)[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> extension </span><br><span class="line">    </span><br><span class="line">    <span class="comment">#获取图片名</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_name</span>(<span class="params">self,url</span>):</span><br><span class="line">        name=url.split(<span class="string">&quot;/&quot;</span>)[-<span class="number">1</span>].split(<span class="string">&quot;.&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> name</span><br></pre></td></tr></table></figure>
<h3 id="代码：功能for-compositesworld-复合材料世界-爬虫程序-详注"><a href="#代码：功能for-compositesworld-复合材料世界-爬虫程序-详注" class="headerlink" title="代码：功能for_compositesworld(复合材料世界)爬虫程序_详注"></a>代码：功能<em>for_compositesworld(复合材料世界)</em>爬虫程序_详注</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># Created on 2018-03-18 18:13:33</span></span><br><span class="line"><span class="comment"># Project: compositesworld</span></span><br><span class="line"><span class="comment">#问题：</span></span><br><span class="line"><span class="comment">#1. 爬取introduction项的正则表达式不够准确，一部分项爬不下来      ---已解决（注意分析网站的html，而不是一味地依赖CSS选择器）</span></span><br><span class="line"><span class="comment">#2. 如何动态、高效地控制爬取的年份截止日期？比如，最早到2016.01.01</span></span><br><span class="line"><span class="comment">#3. 在单步调试，尝试调用保存图片函数时出现 Exception: HTTP 599:…… OpenSSL SSL_connect: SSL_ERROR_SYSCALL in connection to d2n4wb9orp1vta.cloudfront.net:443  错误     ---已解决（似乎与网络连接状况有关，但正常运行时反而没什么问题。暂时忽略）</span></span><br><span class="line"><span class="comment">#4. python反反爬虫机制（代理IP。sleep延时：防止爬取过快导致封IP）      ---已解决。 使用ti.sleep(t)，t为参数，单位为秒。如:ti.time.sleep(3)，表示停顿3秒后继续执行</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pyspider.libs.base_handler <span class="keyword">import</span> *        <span class="comment">#这个库中定义了爬取的各种控制函数和方法</span></span><br><span class="line"><span class="keyword">import</span> re   <span class="comment">#re就是regular expression，即正则表达式。正则表达式（通项公式）是用来简洁表达一组字符串的表达式。优势是简洁，一行胜千言。这个库主要用于字符串匹配。</span></span><br><span class="line"><span class="keyword">from</span> pyspider.database.mysql.mysqldb <span class="keyword">import</span> SQL</span><br><span class="line"><span class="keyword">import</span> sys      <span class="comment">#用于接下来修改编码格式</span></span><br><span class="line"><span class="keyword">import</span> os       <span class="comment">#OS库提供了使用各种操作系统功能的接口</span></span><br><span class="line"><span class="keyword">import</span> time <span class="keyword">as</span> ti       <span class="comment"># 用于延时控制</span></span><br><span class="line"><span class="keyword">from</span> dateutil <span class="keyword">import</span> parser       <span class="comment">#日期处理库，parser子库是根据字符串解析成datetime</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#编码转换</span></span><br><span class="line">reload(sys)     <span class="comment">#Python运行的时候首先加载了site.py，在site.py文件里有这么一段代码:</span></span><br><span class="line">                <span class="comment">#    if hasattr(sys, &quot;setdefaultencoding&quot;):</span></span><br><span class="line">                <span class="comment">#        del sys.setdefaultencoding</span></span><br><span class="line">                <span class="comment">#可以看出，在sys加载后,setdefaultencoding方法被删除了,所以我们要通过重新导入sys来设置系统编码</span></span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;utf8&#x27;</span>)	<span class="comment">#设置默认编码，UTF-8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#图片存放目录</span></span><br><span class="line">DIR_PATH = <span class="string">&quot;./&quot;</span>      <span class="comment"># ./ 的意思是：当前目录（登录pyspider时）</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handler</span>(<span class="title class_ inherited__">BaseHandler</span>):</span><br><span class="line">    </span><br><span class="line">    headers= &#123;</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>:<span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>:<span class="string">&quot;gzip, deflate, sdch&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Language&quot;</span>:<span class="string">&quot;zh-CN,zh;q=0.8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Cache-Control&quot;</span>:<span class="string">&quot;max-age=0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Connection&quot;</span>:<span class="string">&quot;keep-alive&quot;</span>,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.101 Safari/537.36&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    crawl_config = &#123;</span><br><span class="line">        <span class="string">&#x27;itag&#x27;</span>: <span class="string">&#x27;v1.1&#x27;</span>,		<span class="comment">#修改这个tag号，可以重新启动爬取</span></span><br><span class="line">        <span class="string">&quot;headers&quot;</span> : headers,</span><br><span class="line">        <span class="string">&quot;timeout&quot;</span> : <span class="number">100000</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.dir_path = DIR_PATH</span><br><span class="line">        self.tool = Tool()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="meta">    @every(<span class="params">minutes=<span class="number">24</span> * <span class="number">60</span></span>)			</span><span class="comment"># @every修饰器，表示每24小时会执行一次</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_start</span>(<span class="params">self</span>):				<span class="comment"># 这里设置你要爬取的网页URL（最好是列表的形式，按更新顺序排列），先登录看看是否对应，否则容易出错</span></span><br><span class="line">        self.crawl(<span class="string">&#x27;https://www.compositesworld.com/news/list&#x27;</span>,validate_cert=<span class="literal">False</span>, callback=self.index_page)	<span class="comment"># self.crawl 告诉 pyspider 抓取指定页面，然后使用 callback 函数对结果进行解析，并调用接下来的index_page</span></span><br><span class="line"><span class="comment"># 总结：</span></span><br><span class="line"><span class="comment"># 通过 on_start 回调函数，作为爬取的入口点，当点击主面板上的 run 的时候，就是调用这个函数，启动抓取。</span></span><br><span class="line"><span class="comment"># self.crawl 告诉调度器，我们需要抓取 &#x27;https://www.compositesworld.com/news/list&#x27; 这个页面，然后使用 callback=self.index_page 这个回调函数进行解析。</span></span><br><span class="line"><span class="comment"># 所有 return 的内容默认会被捕获到 resultdb 中，可以直接在 WEBUI 上看到（如果结果）。</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @config(<span class="params">age=<span class="number">10</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span></span>)	</span><span class="comment">#在这表示我们认为 10 天内页面有效，不会再次进行更新抓取</span></span><br><span class="line">    <span class="comment">#由此，注意，pyspider不会抓取同一个URL两次（永久丢弃），即使修改了代码，对于第一次运行该项目并修改并第二次运行该项目的初学者来说，这是非常常见的。</span></span><br><span class="line">    <span class="comment">#以上是引述。但是，在实际操作WebUI时，通过单步调试可以很方便地抓取同一个页面。</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index_page</span>(<span class="params">self, response</span>):				<span class="comment">#设置索引页</span></span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> response.doc(<span class="string">&#x27;.headline &gt; a&#x27;</span>).items(): </span><br><span class="line">            self.crawl(each.attr.href, validate_cert=<span class="literal">False</span>,callback=self.detail_page)</span><br><span class="line">        <span class="built_in">next</span> = response.doc(<span class="string">&#x27;a[aria-label=&quot;Next&quot;]&#x27;</span>)</span><br><span class="line">        self.crawl(<span class="built_in">next</span>.attr.href,validate_cert=<span class="literal">False</span>, connect_timeout = <span class="number">5000</span>, timeout = <span class="number">20000</span>,callback=self.index_page)</span><br><span class="line">        <span class="comment"># validate_cert=False 参数，用来解决SSL证书问题，对于以“https”开头的网站，必须添加</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @config(<span class="params">priority=<span class="number">2</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detail_page</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="comment"># 使用CSS正则表达式工具修改doc()中的路径，进行页面上的元素的采集</span></span><br><span class="line">        title = response.doc(<span class="string">&#x27;.content-headline&#x27;</span>).text()</span><br><span class="line">        introduction = response.doc(<span class="string">&#x27;.col-sm-12 &gt; h1&#x27;</span>).text()</span><br><span class="line">        time = response.doc(<span class="string">&#x27;.cell-vert-center &gt; div &gt; span&#x27;</span>).text()</span><br><span class="line">        time = time[<span class="number">10</span>:] <span class="comment">#我这里采用了截取字符段的形式，获得真正的时间字符子序列（不通用！！！）</span></span><br><span class="line">        datetime_struct = parser.parse(time)</span><br><span class="line">        time=datetime_struct.strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)   <span class="comment"># 这里的功能是，将网页代表时间的字符串格式化为%Y-%m-%d（原网页是英文格式）</span></span><br><span class="line">        content = response.doc(<span class="string">&#x27;#short &gt; div &gt; div &gt; p&#x27;</span>).text()</span><br><span class="line">        url = response.url</span><br><span class="line">        picture_url = <span class="string">&#x27;&#x27;</span>    <span class="comment">#与content同理</span></span><br><span class="line">        picture_local_path = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        file_title = re.sub(<span class="string">&#x27;[\/:*?&quot;&lt;&gt;|]&#x27;</span>,<span class="string">&#x27;-&#x27;</span>,title)</span><br><span class="line">        imgDir = self.dir_path</span><br><span class="line">        <span class="keyword">for</span> imgElem <span class="keyword">in</span> response.doc(<span class="string">&#x27;picture &gt; img&#x27;</span>).items():</span><br><span class="line">            imgUrl = imgElem.attr.src</span><br><span class="line">            imgUrl = imgUrl[:-<span class="number">10</span>]  <span class="comment">#为了截掉后面多余的字段&quot;;width=560&quot;，总共10个字符（不通用！！！）</span></span><br><span class="line">            picture_url += imgUrl + <span class="string">&#x27;;&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> imgUrl:</span><br><span class="line">                <span class="comment">#获取图片文件后缀</span></span><br><span class="line">                extension = self.tool.get_extension(imgUrl)</span><br><span class="line">                name = self.tool.get_name(imgUrl)</span><br><span class="line">                <span class="comment">#拼接图片名</span></span><br><span class="line">                file_name = name + <span class="string">&quot;.&quot;</span> + extension</span><br><span class="line">                picture_local_path += <span class="string">&#x27;;&#x27;</span> + file_name</span><br><span class="line">                self.crawl(imgUrl,callback=self.save_img,save=&#123;<span class="string">&quot;file_name&quot;</span>:file_name, <span class="string">&quot;imgDir&quot;</span>:imgDir&#125;,validate_cert=<span class="literal">False</span>, connect_timeout = <span class="number">5000</span>, timeout = <span class="number">20000</span>)   </span><br><span class="line">                <span class="comment"># 这里回调了save_img函数，在单步调试时可以明显看到</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># def detail_page(self, response)作为结果返回一个对象。</span></span><br><span class="line">    <span class="comment"># 结果将被resultdb默认捕获。</span></span><br><span class="line">    <span class="comment"># 可以通过覆盖on_result(self, result)自己管理结果的方法。        </span></span><br><span class="line">        <span class="keyword">return</span> &#123;	<span class="comment"># 与你建立的表结构对应。这是python中的字典结构，即“键-值对”</span></span><br><span class="line">            <span class="string">&quot;title&quot;</span>:title,</span><br><span class="line">            <span class="string">&quot;introduction&quot;</span>:introduction,</span><br><span class="line">            <span class="string">&quot;time&quot;</span>:time,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>:content,</span><br><span class="line">            <span class="string">&quot;keywords&quot;</span>:<span class="string">&quot;null&quot;</span>,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>:<span class="string">&quot;compositesworld&quot;</span>,      <span class="comment">#这里根据你建的表格名修改</span></span><br><span class="line">            <span class="string">&quot;source&quot;</span>:<span class="string">&quot;原创&quot;</span>,</span><br><span class="line">            <span class="string">&quot;url&quot;</span>:url,</span><br><span class="line">            <span class="string">&quot;picture_url&quot;</span>:picture_url,</span><br><span class="line">            <span class="string">&quot;picture_local_path&quot;</span>:picture_local_path</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#保存图片</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_img</span>(<span class="params">self,response</span>):    <span class="comment"># 可以看到，上面save中保存的内容其实通过response传了过来</span></span><br><span class="line">        content = response.content  <span class="comment"># resp.content返回的是bytes型也就是二进制的数据，resp.text返回的是Unicode型的数据。</span></span><br><span class="line">                                    <span class="comment"># 简而言之，如果你想取文本，可以通过r.text。    如果想取图片，文件，则可以通过r.content。</span></span><br><span class="line">        file_name = response.save[<span class="string">&quot;file_name&quot;</span>]</span><br><span class="line">        imgDir = response.save[<span class="string">&quot;imgDir&quot;</span>]</span><br><span class="line">        file_path = imgDir + file_name</span><br><span class="line">        self.tool.save_img(content,imgDir,file_path)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#数据存储函数：on_result方法</span></span><br><span class="line">    <span class="comment"># 调试的时候建议将 on-result 整个移除，便于显示实时获取结果。最后再保存到数据库</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_result</span>(<span class="params">self,result</span>): 		</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> result <span class="keyword">or</span> <span class="keyword">not</span> result[<span class="string">&#x27;title&#x27;</span>]:	<span class="comment"># 如果没到最后，继续返回数据</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        sql = SQL()		<span class="comment"># 覆盖默认方法，使用mysqldb文件中定义的方法，连接数据库</span></span><br><span class="line">        sql.insert(<span class="string">&#x27;compositesworld&#x27;</span>,**result)	<span class="comment">#将结果插入到表格。同理，这里根据你建的表格名修改    </span></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line"><span class="comment">#工具类    </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tool</span>:</span><br><span class="line">    <span class="comment">#保存图片</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_img</span>(<span class="params">self,content,imgDir,path</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(imgDir): 	<span class="comment"># os.path.exists(name)判断是否存在文件或目录name</span></span><br><span class="line">            os.makedirs(imgDir)  <span class="comment"># os.makedirs() 方法用于递归创建目录</span></span><br><span class="line">        f = <span class="built_in">open</span>(path,<span class="string">&quot;wb&quot;</span> )     <span class="comment"># wb 以只写方式打开</span></span><br><span class="line">        f.write(content)        <span class="comment"># 写入文件</span></span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取url后缀名</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_extension</span>(<span class="params">self,url</span>):                            </span><br><span class="line">        extension = url.split(<span class="string">&quot;.&quot;</span>)[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> extension </span><br><span class="line">    </span><br><span class="line">    <span class="comment">#获取图片名</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_name</span>(<span class="params">self,url</span>):</span><br><span class="line">        name=url.split(<span class="string">&quot;/&quot;</span>)[-<span class="number">1</span>].split(<span class="string">&quot;.&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> name</span><br></pre></td></tr></table></figure>
<h3 id="代码：封装for-jeccomposites-JEC-伪宏控制-范式编程"><a href="#代码：封装for-jeccomposites-JEC-伪宏控制-范式编程" class="headerlink" title="代码：封装for_jeccomposites(JEC)伪宏控制__范式编程"></a>代码：封装<em>for_jeccomposites(JEC)</em>伪宏控制__范式编程</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># Created on 2018-03-19 22:26:12</span></span><br><span class="line"><span class="comment"># Project: jeccomposites</span></span><br><span class="line"><span class="comment">#问题：</span></span><br><span class="line"><span class="comment">#1. 爬取下来的content是一连串的字符串，没有考虑到换行的问题，可能需要添加&#x27;\n&#x27;？</span></span><br><span class="line"><span class="comment">#2. 爬取这个网站的content似乎有一段开头是单独放在title的class后面的，或许添加该段？</span></span><br><span class="line"><span class="comment">#3. 是否应该增加一个 tag 标签属性，因为很多网站只有tag但没有keywords，或者两者认为一致？   </span></span><br><span class="line"><span class="comment">#4. [Caution]图片存储功能出现异常错误。显示TypeError与&#x27;NoneType&#x27;和Unicode&#x27;有关   ----已解决（第一，os.makedirs的返回值不是路径。改正这个之后。第二，非常坑！一个意想不到的意外错误！！！！与空格、制表符对齐的区别有关，两者不能混用！！！）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#**********************************************************************************----------~~~~~~~~\</span></span><br><span class="line"><span class="comment">#伪宏控制__范式编程</span></span><br><span class="line"><span class="comment">#------（理论上）你只需要在这里[正确]填入所有信息，整个程序即可运行！【只适用于单一index的爬取。多重分类页面，或者需要对采集的数据做进一步规范化，则必须在后面相应地方改进】</span></span><br><span class="line">project_name = <span class="string">&quot;jeccomposites&quot;</span> 		<span class="comment">#你的项目 的名称</span></span><br><span class="line">website_url_initial = <span class="string">&#x27;http://www.jeccomposites.com/knowledge/international-composites-news&#x27;</span>  <span class="comment">#你爬取的初始网页(index页) 的地址</span></span><br><span class="line">detail_page_css = <span class="string">&#x27;.nodetitle &gt; a&#x27;</span>							<span class="comment">#新闻页面链接 	的CSS表达式</span></span><br><span class="line">next_page_css = <span class="string">&#x27;.pager-next &gt; a&#x27;</span>							<span class="comment">#下一页链接 	的CSS表达式</span></span><br><span class="line">title_css = <span class="string">&#x27;.content &gt; h1&#x27;</span>									<span class="comment">#新闻标题		的CSS表达式</span></span><br><span class="line">introduction_css = <span class="string">&#x27;.content-block-txt &gt; p&#x27;</span>					<span class="comment">#新闻简介		的CSS表达式</span></span><br><span class="line">time_css = <span class="string">&#x27;.content-block-txt &gt; div&#x27;</span>						<span class="comment">#发布时间		的CSS表达式</span></span><br><span class="line">content_css = <span class="string">&#x27;.block-system &gt; div &gt; div div &gt; div &gt; p&#x27;</span>		<span class="comment">#新闻内容		的CSS表达式</span></span><br><span class="line">img_css = <span class="string">&#x27;.content &gt; a &gt; img&#x27;</span>								<span class="comment">#新闻图片		的CSS表达式</span></span><br><span class="line">keywords_css = <span class="string">&#x27;null&#x27;</span>										<span class="comment">#关键词，一般页面中无，因此默认为空。#！【重要：如果其他的 *_css 在网页中也找不到对应项的话，可以填&#x27;null&#x27;，程序将自动返回空值】</span></span><br><span class="line">source_declaration = <span class="string">&quot;原创&quot;</span>									<span class="comment">#原创声明，一般不改动</span></span><br><span class="line"><span class="comment">#**********************************************************************************-----------~~~~~~~/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pyspider.libs.base_handler <span class="keyword">import</span> *        <span class="comment">#这个库中定义了爬取的各种控制函数和方法</span></span><br><span class="line"><span class="keyword">import</span> re   <span class="comment">#re就是regular expression，即正则表达式。正则表达式（通项公式）是用来简洁表达一组字符串的表达式。优势是简洁，一行胜千言。这个库主要用于字符串匹配。</span></span><br><span class="line"><span class="keyword">from</span> pyspider.database.mysql.mysqldb <span class="keyword">import</span> SQL</span><br><span class="line"><span class="keyword">from</span> pyspider.database.mysql.mysqldb_new <span class="keyword">import</span> SQL <span class="keyword">as</span> SQL_new</span><br><span class="line"><span class="keyword">import</span> sys      <span class="comment">#用于接下来修改编码格式</span></span><br><span class="line"><span class="keyword">import</span> os       <span class="comment">#OS库提供了使用各种操作系统功能的接口</span></span><br><span class="line"><span class="keyword">import</span> time <span class="keyword">as</span> ti       <span class="comment"># 用于延时控制</span></span><br><span class="line"><span class="keyword">from</span> dateutil <span class="keyword">import</span> parser       <span class="comment">#日期处理库，parser子库是根据字符串解析成datetime</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#根据项目名称，自动创建表</span></span><br><span class="line">sql_new = SQL_new()</span><br><span class="line">sql_new.create_table(project_name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#图片存放目录【在当前目录自动创建项目子目录，分类各项目的爬取内容。可实现多项目的同时爬取，而内容分开】</span></span><br><span class="line">path_for_project = <span class="string">&quot;./&quot;</span>+project_name+<span class="string">&quot;/&quot;</span>     <span class="comment"># ./ 的意思是：当前目录（登录pyspider时）</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path_for_project):</span><br><span class="line">    os.makedirs(path_for_project)</span><br><span class="line">    DIR_PATH = path_for_project</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    DIR_PATH = path_for_project</span><br><span class="line"><span class="comment">#注意哦，“data”文件夹是pyspider启动时自动生成的，其中的db文件是用来默认储存捕获的数据的。但是，我们已经实现了on_result方法把数据传给了Mysql，所以这data文件夹是不起作用的，因此可以忽略。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#编码转换</span></span><br><span class="line">reload(sys)     <span class="comment">#Python运行的时候首先加载了site.py，在site.py文件里有这么一段代码:</span></span><br><span class="line">                <span class="comment">#    if hasattr(sys, &quot;setdefaultencoding&quot;):</span></span><br><span class="line">                <span class="comment">#        del sys.setdefaultencoding</span></span><br><span class="line">                <span class="comment">#可以看出，在sys加载后,setdefaultencoding方法被删除了,所以我们要通过重新导入sys来设置系统编码</span></span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;utf8&#x27;</span>)  <span class="comment">#设置默认编码，UTF-8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handler</span>(<span class="title class_ inherited__">BaseHandler</span>):</span><br><span class="line">    </span><br><span class="line">    headers= &#123;</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>:<span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>:<span class="string">&quot;gzip, deflate, sdch&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Language&quot;</span>:<span class="string">&quot;zh-CN,zh;q=0.8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Cache-Control&quot;</span>:<span class="string">&quot;max-age=0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Connection&quot;</span>:<span class="string">&quot;keep-alive&quot;</span>,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.101 Safari/537.36&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    crawl_config = &#123;</span><br><span class="line">        <span class="string">&#x27;itag&#x27;</span>: <span class="string">&#x27;v1.1&#x27;</span>,     <span class="comment">#修改这个tag号，可以重新启动爬取</span></span><br><span class="line">        <span class="string">&quot;headers&quot;</span> : headers,</span><br><span class="line">        <span class="string">&quot;timeout&quot;</span> : <span class="number">100000</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.dir_path = DIR_PATH</span><br><span class="line">        self.tool = Tool()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="meta">    @every(<span class="params">minutes=<span class="number">24</span> * <span class="number">60</span></span>)         </span><span class="comment"># @every修饰器，表示每24小时会执行一次</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_start</span>(<span class="params">self</span>):             <span class="comment"># 这里设置你要爬取的网页URL（最好是列表的形式，按更新顺序排列），先登录看看是否对应，否则容易出错</span></span><br><span class="line">        self.crawl(website_url_initial,validate_cert=<span class="literal">False</span>, callback=self.index_page)    <span class="comment"># self.crawl 告诉 pyspider 抓取指定页面，然后使用 callback 函数对结果进行解析，并调用接下来的index_page</span></span><br><span class="line"><span class="comment"># 总结：</span></span><br><span class="line"><span class="comment"># 通过 on_start 回调函数，作为爬取的入口点，当点击主面板上的 run 的时候，就是调用这个函数，启动抓取。</span></span><br><span class="line"><span class="comment"># self.crawl 告诉调度器，我们需要抓取 &#x27;某个url&#x27; 这个页面，然后使用 callback=self.index_page 这个回调函数进行解析。</span></span><br><span class="line"><span class="comment"># 所有 return 的内容默认会被捕获到 resultdb 中，可以直接在 WEBUI 上看到（如果结果）。</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @config(<span class="params">age=<span class="number">10</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span></span>)  </span><span class="comment">#在这表示我们认为 10 天内页面有效，不会再次进行更新抓取</span></span><br><span class="line">    <span class="comment">#由此，注意，pyspider不会抓取同一个URL两次（永久丢弃），即使修改了代码，对于第一次运行该项目并修改并第二次运行该项目的初学者来说，这是非常常见的。</span></span><br><span class="line">    <span class="comment">#以上是引述。但是，在实际操作WebUI时，通过单步调试可以很方便地抓取同一个页面。</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index_page</span>(<span class="params">self, response</span>):             <span class="comment">#设置索引页</span></span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> response.doc(detail_page_css).items(): </span><br><span class="line">            self.crawl(each.attr.href, validate_cert=<span class="literal">False</span>,callback=self.detail_page)</span><br><span class="line">        <span class="built_in">next</span> = response.doc(next_page_css)</span><br><span class="line">        self.crawl(<span class="built_in">next</span>.attr.href,validate_cert=<span class="literal">False</span>, connect_timeout = <span class="number">5000</span>, timeout = <span class="number">20000</span>,callback=self.index_page)</span><br><span class="line">        <span class="comment"># validate_cert=False 参数，用来解决SSL证书问题，对于以“https”开头的网站，必须添加</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @config(<span class="params">priority=<span class="number">2</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detail_page</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="comment"># 使用CSS正则表达式工具修改doc()中的路径，进行页面上的元素的采集</span></span><br><span class="line">        title = title_css</span><br><span class="line">        <span class="keyword">if</span> (title_css != <span class="string">&#x27;null&#x27;</span>):</span><br><span class="line">        	title = response.doc(title_css).text()</span><br><span class="line">        introduction = introduction_css</span><br><span class="line">        <span class="keyword">if</span> (introduction_css != <span class="string">&#x27;null&#x27;</span>):</span><br><span class="line">        	introduction = response.doc(introduction_css).text()</span><br><span class="line">        time = time_css</span><br><span class="line">        <span class="keyword">if</span> (time_css != <span class="string">&#x27;null&#x27;</span>):</span><br><span class="line">        	time = response.doc(time_css).text()</span><br><span class="line"><span class="comment">#        time = time[10:] #我这里采用了截取字符段的形式，获得真正的时间字符子序列（不通用！！！）</span></span><br><span class="line">        	datetime_struct = parser.parse(time)</span><br><span class="line">        	time=datetime_struct.strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)   <span class="comment"># 这里的功能是，将网页代表时间的字符串格式化为%Y-%m-%d（原网页是英文格式）</span></span><br><span class="line">        content = content_css</span><br><span class="line">        <span class="keyword">if</span> (content_css != <span class="string">&#x27;null&#x27;</span>):</span><br><span class="line">        	content = response.doc(content_css).text()</span><br><span class="line">        keywords = keywords_css</span><br><span class="line">        <span class="keyword">if</span> (keywords_css != <span class="string">&#x27;null&#x27;</span>):</span><br><span class="line">        	keywords = response.doc(keywords_css).text()        	</span><br><span class="line">        url = response.url</span><br><span class="line">        picture_url = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        picture_local_path = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        file_title = re.sub(<span class="string">&#x27;[\/:*?&quot;&lt;&gt;|]&#x27;</span>,<span class="string">&#x27;-&#x27;</span>,title)</span><br><span class="line">        imgDir = self.dir_path</span><br><span class="line">        <span class="keyword">for</span> imgElem <span class="keyword">in</span> response.doc(img_css).items():</span><br><span class="line">            imgUrl = imgElem.attr.src</span><br><span class="line"><span class="comment">#            imgUrl = imgUrl[:-10]  #为了截掉后面多余的字段&quot;;width=560&quot;，总共10个字符（不通用！！！）</span></span><br><span class="line">            <span class="keyword">if</span> imgUrl <span class="keyword">and</span> self.tool.get_name(imgUrl) != <span class="string">&#x27;logo&#x27;</span>:  <span class="comment">#这个网站每个网页都莫名其妙地爬两个logo图片下来，因此要过滤掉（不通用！！！）</span></span><br><span class="line">                picture_url += imgUrl + <span class="string">&#x27;;&#x27;</span>  <span class="comment">#picture_url和picture_local_path都需要滞后于这个过滤操作</span></span><br><span class="line">                <span class="comment">#获取图片文件后缀</span></span><br><span class="line">                extension = self.tool.get_extension(imgUrl)</span><br><span class="line">                name = self.tool.get_name(imgUrl)</span><br><span class="line">                <span class="comment">#拼接图片名</span></span><br><span class="line">                file_name = name + <span class="string">&quot;.&quot;</span> + extension</span><br><span class="line">                picture_local_path += <span class="string">&#x27;;&#x27;</span> + file_name</span><br><span class="line">                self.crawl(imgUrl,callback=self.save_img,save=&#123;<span class="string">&quot;file_name&quot;</span>:file_name, <span class="string">&quot;imgDir&quot;</span>:imgDir&#125;,validate_cert=<span class="literal">False</span>, connect_timeout = <span class="number">5000</span>, timeout = <span class="number">20000</span>)   </span><br><span class="line">                <span class="comment"># 这里回调了save_img函数，在单步调试时可以明显看到</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># def detail_page(self, response)作为结果返回一个对象。</span></span><br><span class="line">    <span class="comment"># 结果将被resultdb默认捕获。</span></span><br><span class="line">    <span class="comment"># 可以通过覆盖on_result(self, result)自己管理结果的方法。        </span></span><br><span class="line">        <span class="keyword">return</span> &#123;    <span class="comment"># 与你建立的表结构对应。这是python中的字典结构，即“键-值对”</span></span><br><span class="line">            <span class="string">&quot;title&quot;</span>:title,</span><br><span class="line">            <span class="string">&quot;introduction&quot;</span>:introduction,</span><br><span class="line">            <span class="string">&quot;time&quot;</span>:time,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>:content,</span><br><span class="line">            <span class="string">&quot;keywords&quot;</span>:keywords,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>:project_name,      <span class="comment">#这里根据你建的表格名修改</span></span><br><span class="line">            <span class="string">&quot;source&quot;</span>:source_declaration,</span><br><span class="line">            <span class="string">&quot;url&quot;</span>:url,</span><br><span class="line">            <span class="string">&quot;picture_url&quot;</span>:<span class="string">&#x27;null&#x27;</span> <span class="keyword">if</span> picture_url == <span class="string">&#x27;&#x27;</span> <span class="keyword">else</span> picture_url,</span><br><span class="line">            <span class="string">&quot;picture_local_path&quot;</span>:<span class="string">&#x27;null&#x27;</span> <span class="keyword">if</span> picture_local_path == <span class="string">&#x27;&#x27;</span> <span class="keyword">else</span> picture_local_path</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#保存图片</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_img</span>(<span class="params">self,response</span>):    <span class="comment"># 可以看到，上面save中保存的内容其实通过response传了过来</span></span><br><span class="line">        content = response.content  <span class="comment"># resp.content返回的是bytes型也就是二进制的数据，resp.text返回的是Unicode型的数据。</span></span><br><span class="line">                                    <span class="comment"># 简而言之，如果你想取文本，可以通过r.text。    如果想取图片，文件，则可以通过r.content。</span></span><br><span class="line">        file_name = response.save[<span class="string">&quot;file_name&quot;</span>]</span><br><span class="line">        imgDir = response.save[<span class="string">&quot;imgDir&quot;</span>]</span><br><span class="line">        file_path = imgDir + file_name</span><br><span class="line">        self.tool.save_img(content,imgDir,file_path)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#数据存储函数：on_result方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_result</span>(<span class="params">self,result</span>):         </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> result <span class="keyword">or</span> <span class="keyword">not</span> result[<span class="string">&#x27;title&#x27;</span>]:   <span class="comment"># 如果没到最后，继续返回数据</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        sql = SQL()     <span class="comment"># 覆盖默认方法，使用mysqldb文件中定义的方法，连接数据库</span></span><br><span class="line">        sql.insert(project_name,**result)  <span class="comment">#将结果插入到表格。同理，这里根据你建的表格名修改    </span></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line"><span class="comment">#工具类    </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tool</span>:</span><br><span class="line">    <span class="comment">#保存图片</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_img</span>(<span class="params">self,content,imgDir,path</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(imgDir):  <span class="comment"># os.path.exists(name)判断是否存在文件或目录name</span></span><br><span class="line">            os.makedirs(imgDir)  <span class="comment"># os.makedirs() 方法用于递归创建目录</span></span><br><span class="line">        f = <span class="built_in">open</span>(path,<span class="string">&quot;wb&quot;</span> )     <span class="comment"># wb 以只写方式打开</span></span><br><span class="line">        f.write(content)        <span class="comment"># 写入文件</span></span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取url后缀名</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_extension</span>(<span class="params">self,url</span>):                            </span><br><span class="line">        extension = url.split(<span class="string">&quot;.&quot;</span>)[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> extension </span><br><span class="line">    </span><br><span class="line">    <span class="comment">#获取图片名</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_name</span>(<span class="params">self,url</span>):</span><br><span class="line">        name=url.split(<span class="string">&quot;/&quot;</span>)[-<span class="number">1</span>].split(<span class="string">&quot;.&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> name</span><br></pre></td></tr></table></figure>
<h3 id="代码：forcompositesworld-复合材料世界-基于JEC通用化代码模板-改进版"><a href="#代码：forcompositesworld-复合材料世界-基于JEC通用化代码模板-改进版" class="headerlink" title="代码：forcompositesworld(复合材料世界)基于JEC通用化代码模板_改进版"></a>代码：for<em>compositesworld(复合材料世界)</em>基于JEC通用化代码模板_改进版</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># Created on 2018-03-19 22:26:12</span></span><br><span class="line"><span class="comment"># Project: Model</span></span><br><span class="line"><span class="comment">#问题：</span></span><br><span class="line"><span class="comment">#1. ValueError(u&#x27;String does not contain a date)。time的抓取规则仍待改善。对于特别难分离的日期，需要更先进的手段。  ---已解决，注意首先要选择合适、准确、无歧义的CSS表达式。再进行时间格式的处理！或者选取更合适的日期项，如在首页中选择。</span></span><br><span class="line"><span class="comment">#2. 仍然有少量OpenSSL connet SSL_ERROR_SYSCALL型的错误。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#**********************************************************************************----------~~~~~~~~\</span></span><br><span class="line"><span class="comment">#伪宏控制__范式编程</span></span><br><span class="line"><span class="comment">#------（理论上）你只需要在这里[正确]填入所有信息，整个程序即可运行！【只适用于单一index的爬取。多重分类页面，或者需要对采集的数据做进一步规范化，则必须在后面相应地方改进】</span></span><br><span class="line">project_name = <span class="string">&quot;compositesworld&quot;</span>        <span class="comment">#你的项目 的名称</span></span><br><span class="line">website_url_initial = <span class="string">&#x27;https://www.compositesworld.com/news/list&#x27;</span>  <span class="comment">#你爬取的初始网页(index页) 的地址</span></span><br><span class="line">detail_page_css = <span class="string">&#x27;.headline &gt; a&#x27;</span>                           <span class="comment">#新闻页面链接     的CSS表达式</span></span><br><span class="line">next_page_css = <span class="string">&#x27;a[aria-label=&quot;Next&quot;]&#x27;</span>                          <span class="comment">#下一页链接  的CSS表达式</span></span><br><span class="line">title_css = <span class="string">&#x27;.content-headline&#x27;</span>                                 <span class="comment">#新闻标题       的CSS表达式</span></span><br><span class="line">introduction_css = <span class="string">&#x27;.col-sm-12 &gt; h1&#x27;</span>                    <span class="comment">#新闻简介       的CSS表达式</span></span><br><span class="line">time_css = <span class="string">&#x27;.clearfix span[property=&quot;dc:created&quot;]&#x27;</span>                     <span class="comment">#发布时间       的CSS表达式</span></span><br><span class="line">content_css = <span class="string">&#x27;#short &gt; div &gt; div &gt; p&#x27;</span>      <span class="comment">#新闻内容       的CSS表达式</span></span><br><span class="line">img_css = <span class="string">&#x27;picture &gt; img&#x27;</span>                               <span class="comment">#新闻图片       的CSS表达式</span></span><br><span class="line">keywords_css = <span class="string">&#x27;null&#x27;</span>                                       <span class="comment">#关键词，一般页面中无，因此默认为空。#！【重要：如果其他的 *_css 在网页中也找不到对应项的话，可以填&#x27;null&#x27;，程序将自动返回空值】</span></span><br><span class="line">source_declaration = <span class="string">&quot;原创&quot;</span>                                   <span class="comment">#原创声明，一般不改动</span></span><br><span class="line"><span class="comment">#**********************************************************************************-----------~~~~~~~/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pyspider.libs.base_handler <span class="keyword">import</span> *        <span class="comment">#这个库中定义了爬取的各种控制函数和方法</span></span><br><span class="line"><span class="keyword">import</span> re   <span class="comment">#re就是regular expression，即正则表达式。正则表达式（通项公式）是用来简洁表达一组字符串的表达式。优势是简洁，一行胜千言。这个库主要用于字符串匹配。</span></span><br><span class="line"><span class="keyword">from</span> pyspider.database.mysql.mysqldb <span class="keyword">import</span> SQL</span><br><span class="line"><span class="keyword">from</span> pyspider.database.mysql.mysqldb_new <span class="keyword">import</span> SQL <span class="keyword">as</span> SQL_new</span><br><span class="line"><span class="keyword">import</span> sys      <span class="comment">#用于接下来修改编码格式</span></span><br><span class="line"><span class="keyword">import</span> os       <span class="comment">#OS库提供了使用各种操作系统功能的接口</span></span><br><span class="line"><span class="keyword">import</span> time <span class="keyword">as</span> ti       <span class="comment"># 用于延时控制</span></span><br><span class="line"><span class="keyword">from</span> dateutil <span class="keyword">import</span> parser       <span class="comment">#日期处理库，parser子库是根据字符串解析成datetime</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#根据项目名称，自动创建表</span></span><br><span class="line">sql_new = SQL_new()</span><br><span class="line">sql_new.create_table(project_name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#图片存放目录【在当前目录自动创建项目子目录，分类各项目的爬取内容。可实现多项目的同时爬取，而内容分开】</span></span><br><span class="line">path_for_project = <span class="string">&quot;./&quot;</span>+project_name+<span class="string">&quot;/&quot;</span>     <span class="comment"># ./ 的意思是：当前目录（登录pyspider时）</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path_for_project):</span><br><span class="line">    os.makedirs(path_for_project)</span><br><span class="line">    DIR_PATH = path_for_project</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    DIR_PATH = path_for_project</span><br><span class="line"><span class="comment">#注意哦，“data”文件夹是pyspider启动时自动生成的，其中的db文件是用来默认储存捕获的数据的。但是，我们已经实现了on_result方法把数据传给了Mysql，所以这data文件夹是不起作用的，因此可以忽略。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#编码转换</span></span><br><span class="line">reload(sys)     <span class="comment">#Python运行的时候首先加载了site.py，在site.py文件里有这么一段代码:</span></span><br><span class="line">                <span class="comment">#    if hasattr(sys, &quot;setdefaultencoding&quot;):</span></span><br><span class="line">                <span class="comment">#        del sys.setdefaultencoding</span></span><br><span class="line">                <span class="comment">#可以看出，在sys加载后,setdefaultencoding方法被删除了,所以我们要通过重新导入sys来设置系统编码</span></span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;utf8&#x27;</span>)  <span class="comment">#设置默认编码，UTF-8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handler</span>(<span class="title class_ inherited__">BaseHandler</span>):</span><br><span class="line">    </span><br><span class="line">    headers= &#123;</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>:<span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Encoding&quot;</span>:<span class="string">&quot;gzip, deflate, sdch&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Language&quot;</span>:<span class="string">&quot;zh-CN,zh;q=0.8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Cache-Control&quot;</span>:<span class="string">&quot;max-age=0&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Connection&quot;</span>:<span class="string">&quot;keep-alive&quot;</span>,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.101 Safari/537.36&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    crawl_config = &#123;</span><br><span class="line">        <span class="string">&#x27;itag&#x27;</span>: <span class="string">&#x27;v1.1&#x27;</span>,     <span class="comment">#修改这个tag号，可以重新启动爬取</span></span><br><span class="line">        <span class="string">&quot;headers&quot;</span> : headers,</span><br><span class="line">        <span class="string">&quot;timeout&quot;</span> : <span class="number">100000</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.dir_path = DIR_PATH</span><br><span class="line">        self.tool = Tool()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="meta">    @every(<span class="params">minutes=<span class="number">24</span> * <span class="number">60</span></span>)         </span><span class="comment"># @every修饰器，表示每24小时会执行一次</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_start</span>(<span class="params">self</span>):             <span class="comment"># 这里设置你要爬取的网页URL（最好是列表的形式，按更新顺序排列），先登录看看是否对应，否则容易出错</span></span><br><span class="line">        self.crawl(website_url_initial,validate_cert=<span class="literal">False</span>, callback=self.index_page)    <span class="comment"># self.crawl 告诉 pyspider 抓取指定页面，然后使用 callback 函数对结果进行解析，并调用接下来的index_page</span></span><br><span class="line"><span class="comment"># 总结：</span></span><br><span class="line"><span class="comment"># 通过 on_start 回调函数，作为爬取的入口点，当点击主面板上的 run 的时候，就是调用这个函数，启动抓取。</span></span><br><span class="line"><span class="comment"># self.crawl 告诉调度器，我们需要抓取 &#x27;某个url&#x27; 这个页面，然后使用 callback=self.index_page 这个回调函数进行解析。</span></span><br><span class="line"><span class="comment"># 所有 return 的内容默认会被捕获到 resultdb 中，可以直接在 WEBUI 上看到（如果结果）。</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @config(<span class="params">age=<span class="number">10</span> * <span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span></span>)  </span><span class="comment">#在这表示我们认为 10 天内页面有效，不会再次进行更新抓取</span></span><br><span class="line">    <span class="comment">#由此，注意，pyspider不会抓取同一个URL两次（永久丢弃），即使修改了代码，对于第一次运行该项目并修改并第二次运行该项目的初学者来说，这是非常常见的。</span></span><br><span class="line">    <span class="comment">#以上是引述。但是，在实际操作WebUI时，通过单步调试可以很方便地抓取同一个页面。</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">index_page</span>(<span class="params">self, response</span>):             <span class="comment">#设置索引页</span></span><br><span class="line">        <span class="keyword">for</span> each <span class="keyword">in</span> response.doc(detail_page_css).items(): </span><br><span class="line">            self.crawl(each.attr.href, validate_cert=<span class="literal">False</span>,callback=self.detail_page)</span><br><span class="line">        <span class="built_in">next</span> = response.doc(next_page_css)</span><br><span class="line">        self.crawl(<span class="built_in">next</span>.attr.href,validate_cert=<span class="literal">False</span>, connect_timeout = <span class="number">5000</span>, timeout = <span class="number">20000</span>,callback=self.index_page)</span><br><span class="line">        <span class="comment"># validate_cert=False 参数，用来解决SSL证书问题，对于以“https”开头的网站，必须添加</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @config(<span class="params">priority=<span class="number">2</span></span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">detail_page</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="comment"># 使用CSS正则表达式工具修改doc()中的路径，进行页面上的元素的采集</span></span><br><span class="line">        title = title_css</span><br><span class="line">        <span class="keyword">if</span> (title_css != <span class="string">&#x27;null&#x27;</span>):</span><br><span class="line">            title = response.doc(title_css).text()</span><br><span class="line">        introduction = introduction_css</span><br><span class="line">        <span class="keyword">if</span> (introduction_css != <span class="string">&#x27;null&#x27;</span>):</span><br><span class="line">            introduction = response.doc(introduction_css).text()</span><br><span class="line">        time = time_css         <span class="comment">#以下都是在改日期判断</span></span><br><span class="line">        <span class="keyword">if</span> (time_css != <span class="string">&#x27;null&#x27;</span>):</span><br><span class="line">            time = response.doc(time_css).text()</span><br><span class="line">            time.strip()  <span class="comment">#先作去空格处理</span></span><br><span class="line">            time = time[<span class="number">10</span>:] <span class="comment">#我这里采用了截取字符段的形式，获得真正的时间字符子序列（不通用！！！）</span></span><br><span class="line">            datetime_struct = parser.parse(time)</span><br><span class="line">            time=datetime_struct.strftime(<span class="string">&#x27;%Y-%m-%d&#x27;</span>)   <span class="comment"># 这里的功能是，将网页代表时间的字符串格式化为%Y-%m-%d（原网页是英文格式）</span></span><br><span class="line">        content = content_css</span><br><span class="line">        <span class="keyword">if</span> (content_css != <span class="string">&#x27;null&#x27;</span>):</span><br><span class="line">            content = response.doc(content_css).text()</span><br><span class="line">        keywords = keywords_css</span><br><span class="line">        <span class="keyword">if</span> (keywords_css != <span class="string">&#x27;null&#x27;</span>):</span><br><span class="line">            keywords = response.doc(keywords_css).text()            </span><br><span class="line">        url = response.url</span><br><span class="line">        picture_url = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        picture_local_path = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        file_title = re.sub(<span class="string">&#x27;[\/:*?&quot;&lt;&gt;|]&#x27;</span>,<span class="string">&#x27;-&#x27;</span>,title)</span><br><span class="line">        imgDir = self.dir_path</span><br><span class="line">        <span class="keyword">for</span> imgElem <span class="keyword">in</span> response.doc(img_css).items():</span><br><span class="line">            imgUrl = imgElem.attr.src</span><br><span class="line">            imgUrl = imgUrl[:-<span class="number">10</span>]  <span class="comment">#为了截掉后面多余的字段&quot;;width=560&quot;，总共10个字符（不通用！！！）</span></span><br><span class="line">            <span class="keyword">if</span> imgUrl:  </span><br><span class="line">                picture_url += imgUrl + <span class="string">&#x27;;&#x27;</span>  <span class="comment">#picture_url和picture_local_path都需要滞后于这个过滤操作</span></span><br><span class="line">                <span class="comment">#获取图片文件后缀</span></span><br><span class="line">                extension = self.tool.get_extension(imgUrl)</span><br><span class="line">                name = self.tool.get_name(imgUrl)</span><br><span class="line">                <span class="comment">#拼接图片名</span></span><br><span class="line">                file_name = name + <span class="string">&quot;.&quot;</span> + extension</span><br><span class="line">                picture_local_path += <span class="string">&#x27;;&#x27;</span> + file_name</span><br><span class="line">                self.crawl(imgUrl,callback=self.save_img,save=&#123;<span class="string">&quot;file_name&quot;</span>:file_name, <span class="string">&quot;imgDir&quot;</span>:imgDir&#125;,validate_cert=<span class="literal">False</span>, connect_timeout = <span class="number">5000</span>, timeout = <span class="number">20000</span>)   </span><br><span class="line">                <span class="comment"># 这里回调了save_img函数，在单步调试时可以明显看到</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># def detail_page(self, response)作为结果返回一个对象。</span></span><br><span class="line">    <span class="comment"># 结果将被resultdb默认捕获。</span></span><br><span class="line">    <span class="comment"># 可以通过覆盖on_result(self, result)自己管理结果的方法。        </span></span><br><span class="line">        <span class="keyword">return</span> &#123;    <span class="comment"># 与你建立的表结构对应。这是python中的字典结构，即“键-值对”</span></span><br><span class="line">            <span class="string">&quot;title&quot;</span>:title,</span><br><span class="line">            <span class="string">&quot;introduction&quot;</span>:introduction,</span><br><span class="line">            <span class="string">&quot;time&quot;</span>:time,</span><br><span class="line">            <span class="string">&quot;content&quot;</span>:content,</span><br><span class="line">            <span class="string">&quot;keywords&quot;</span>:keywords,</span><br><span class="line">            <span class="string">&quot;name&quot;</span>:project_name,      <span class="comment">#这里根据你建的表格名修改</span></span><br><span class="line">            <span class="string">&quot;source&quot;</span>:source_declaration,</span><br><span class="line">            <span class="string">&quot;url&quot;</span>:url,</span><br><span class="line">            <span class="string">&quot;picture_url&quot;</span>:<span class="string">&#x27;null&#x27;</span> <span class="keyword">if</span> picture_url == <span class="string">&#x27;&#x27;</span> <span class="keyword">else</span> picture_url,</span><br><span class="line">            <span class="string">&quot;picture_local_path&quot;</span>:<span class="string">&#x27;null&#x27;</span> <span class="keyword">if</span> picture_local_path == <span class="string">&#x27;&#x27;</span> <span class="keyword">else</span> picture_local_path</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#保存图片</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_img</span>(<span class="params">self,response</span>):    <span class="comment"># 可以看到，上面save中保存的内容其实通过response传了过来</span></span><br><span class="line">        content = response.content  <span class="comment"># resp.content返回的是bytes型也就是二进制的数据，resp.text返回的是Unicode型的数据。</span></span><br><span class="line">                                    <span class="comment"># 简而言之，如果你想取文本，可以通过r.text。    如果想取图片，文件，则可以通过r.content。</span></span><br><span class="line">        file_name = response.save[<span class="string">&quot;file_name&quot;</span>]</span><br><span class="line">        imgDir = response.save[<span class="string">&quot;imgDir&quot;</span>]</span><br><span class="line">        file_path = imgDir + file_name</span><br><span class="line">        self.tool.save_img(content,imgDir,file_path)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#数据存储函数：on_result方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_result</span>(<span class="params">self,result</span>):         </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> result <span class="keyword">or</span> <span class="keyword">not</span> result[<span class="string">&#x27;title&#x27;</span>]:   <span class="comment"># 如果没到最后，继续返回数据</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        sql = SQL()     <span class="comment"># 覆盖默认方法，使用mysqldb文件中定义的方法，连接数据库</span></span><br><span class="line">        sql.insert(project_name,**result)  <span class="comment">#将结果插入到表格。同理，这里根据你建的表格名修改    </span></span><br><span class="line">        </span><br><span class="line">    </span><br><span class="line"><span class="comment">#工具类    </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tool</span>:</span><br><span class="line">    <span class="comment">#保存图片</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_img</span>(<span class="params">self,content,imgDir,path</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(imgDir):  <span class="comment"># os.path.exists(name)判断是否存在文件或目录name</span></span><br><span class="line">            os.makedirs(imgDir)  <span class="comment"># os.makedirs() 方法用于递归创建目录</span></span><br><span class="line">        f = <span class="built_in">open</span>(path,<span class="string">&quot;wb&quot;</span> )     <span class="comment"># wb 以只写方式打开</span></span><br><span class="line">        f.write(content)        <span class="comment"># 写入文件</span></span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取url后缀名</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_extension</span>(<span class="params">self,url</span>):                            </span><br><span class="line">        extension = url.split(<span class="string">&quot;.&quot;</span>)[-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> extension </span><br><span class="line">    </span><br><span class="line">    <span class="comment">#获取图片名</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_name</span>(<span class="params">self,url</span>):</span><br><span class="line">        name=url.split(<span class="string">&quot;/&quot;</span>)[-<span class="number">1</span>].split(<span class="string">&quot;.&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> name</span><br></pre></td></tr></table></figure>
<h3 id="代码：testpro通过调用MySQLnew实现自动创建列表-demo"><a href="#代码：testpro通过调用MySQLnew实现自动创建列表-demo" class="headerlink" title="代码：testpro通过调用MySQLnew实现自动创建列表_demo"></a>代码：test<em>pro</em>通过调用MySQLnew实现自动创建列表_demo</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyspider.database.mysql.mysqldb_new <span class="keyword">import</span> SQL</span><br><span class="line"></span><br><span class="line">sql = SQL()		<span class="comment">#定义一个SQL对象</span></span><br><span class="line">sql.create_table(<span class="string">&quot;test_for_auto_table_maker&quot;</span>)	<span class="comment">#用这个对象的create_table方法创建表格，表名为&quot;test_for_auto_table_maker&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="代码：mysqldb-new（库）"><a href="#代码：mysqldb-new（库）" class="headerlink" title="代码：mysqldb_new（库）"></a>代码：mysqldb_new（库）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#【备注：使用该改进方法可能需要安装的库：sqlalchemy，mysql-connector。均可用pip install快速安装】</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> six <span class="keyword">import</span> itervalues</span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.databases <span class="keyword">import</span> mysql</span><br><span class="line"><span class="comment">#from sqlalchemy.ext.declarative import declarative_base</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#利用MySQLdb来建立一个名字是变量的表实在太困难了</span></span><br><span class="line"><span class="comment">#因此采用了另一个库：sqlalchemy</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SQL</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment">#数据库初始化</span></span><br><span class="line">        <span class="comment">#数据库连接相关信息（全局化处理）【要实现自动创建表格，必须注意调节create_table中的连接参数信息】</span></span><br><span class="line">        hosts    = <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">        username = <span class="string">&#x27;root&#x27;</span></span><br><span class="line">        password = <span class="string">&#x27;233333&#x27;</span></span><br><span class="line">        database = <span class="string">&#x27;pyspider&#x27;</span></span><br><span class="line">        charsets = <span class="string">&#x27;utf8&#x27;</span></span><br><span class="line">        port_number = <span class="number">3307</span></span><br><span class="line">        self.connection = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.conn = MySQLdb.connect(host = hosts,user = username,passwd = password,db = database,charset = charsets, port = port_number)</span><br><span class="line">            self.cursor = self.conn.cursor()</span><br><span class="line">            self.cursor.execute(<span class="string">&quot;set names &quot;</span>+charsets)</span><br><span class="line">            self.connection = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">except</span> Exception,e:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;Cannot Connect To Mysql!/n&quot;</span>,e</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">escape</span>(<span class="params">self,string</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;%s&#x27;</span> % string</span><br><span class="line">    <span class="comment">#插入数据到数据库</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">insert</span>(<span class="params">self,tablename=<span class="literal">None</span>,**values</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.connection:</span><br><span class="line">            tablename = self.escape(tablename)</span><br><span class="line">            <span class="keyword">if</span> values:</span><br><span class="line">                _keys = <span class="string">&quot;,&quot;</span>.join(self.escape(k) <span class="keyword">for</span> k <span class="keyword">in</span> values)</span><br><span class="line">                _values = <span class="string">&quot;,&quot;</span>.join([<span class="string">&#x27;%s&#x27;</span>,]*<span class="built_in">len</span>(values))</span><br><span class="line">                sql_query = <span class="string">&quot;insert into %s (%s) values (%s)&quot;</span> % (tablename,_keys,_values)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                sql_query = <span class="string">&quot;replace into %s default values&quot;</span> % tablename</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> values:</span><br><span class="line">                    self.cursor.execute(sql_query,<span class="built_in">list</span>(itervalues(values)))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.cursor.execute(sql_query)</span><br><span class="line">                self.conn.commit()</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">            <span class="keyword">except</span> Exception,e:</span><br><span class="line">                <span class="built_in">print</span> <span class="string">&quot;An Error Occured: &quot;</span>,e</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="comment"># 用于建立表格，可能之后需要加强try-except机制</span></span><br><span class="line">    <span class="comment"># 【经测试，该方法不会覆盖掉已经创建过的表格】</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_table</span>(<span class="params">self,project_name</span>):</span><br><span class="line">        <span class="comment">#定义引擎</span></span><br><span class="line">        engine = create_engine(<span class="string">&#x27;mysql+mysqlconnector://root:fdzxks@localhost:3307/pyspider&#x27;</span>)        <span class="comment"># 这里的引擎与上面的连接参数要相应一致</span></span><br><span class="line">        <span class="comment">#绑定元信息</span></span><br><span class="line">        metadata = MetaData(engine)</span><br><span class="line">        <span class="comment">#创建表格，初始化数据库</span></span><br><span class="line">        user = Table(project_name, metadata,</span><br><span class="line">            Column(<span class="string">&#x27;title&#x27;</span>, VARCHAR(<span class="number">255</span>)),</span><br><span class="line">            Column(<span class="string">&#x27;introduction&#x27;</span>, mysql.MSLongText),</span><br><span class="line">            Column(<span class="string">&#x27;time&#x27;</span>, VARCHAR(<span class="number">255</span>)),</span><br><span class="line">            Column(<span class="string">&#x27;content&#x27;</span>, mysql.MSLongText),</span><br><span class="line">            Column(<span class="string">&#x27;keywords&#x27;</span>, VARCHAR(<span class="number">255</span>)),</span><br><span class="line">            Column(<span class="string">&#x27;name&#x27;</span>, VARCHAR(<span class="number">255</span>)),</span><br><span class="line">            Column(<span class="string">&#x27;source&#x27;</span>, VARCHAR(<span class="number">255</span>)),</span><br><span class="line">            Column(<span class="string">&#x27;url&#x27;</span>, VARCHAR(<span class="number">255</span>)),</span><br><span class="line">            Column(<span class="string">&#x27;picture_url&#x27;</span>, mysql.MSLongText),</span><br><span class="line">            Column(<span class="string">&#x27;picture_local_path&#x27;</span>, mysql.MSLongText),</span><br><span class="line">                    )</span><br><span class="line">        <span class="comment">#http://blog.csdn.net/FeiSan/article/details/1887677。教程：SQLAlchemy下定义MySQL特有的字段类型。</span></span><br><span class="line">        <span class="comment">#创建数据表，如果数据表存在则忽视</span></span><br><span class="line">        metadata.create_all(engine)</span><br><span class="line">        <span class="comment">#获取数据库链接，以备后面使用</span></span><br><span class="line">        conn = engine.connect()</span><br></pre></td></tr></table></figure>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>工云
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/" title="Pyspider操作指南">https://stellarkey.github.io/Pyspider操作指南/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Pyspider/" rel="tag"><i class="fa fa-tag"></i> Pyspider</a>
              <a href="/tags/Python/" rel="tag"><i class="fa fa-tag"></i> Python</a>
              <a href="/tags/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/" rel="tag"><i class="fa fa-tag"></i> 网络爬虫</a>
          </div>

        
  <div class="post-widgets">
    <div class="wp_rating">
      <div id="wpac-rating"></div>
    </div>
  </div>


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E4%B8%8E%E5%BA%94%E7%94%A8%E7%B3%BB%E5%88%97%E8%AE%B2%E5%BA%A7/" rel="prev" title="《大数据科学与应用系列讲座》笔记">
      <i class="fa fa-chevron-left"></i> 《大数据科学与应用系列讲座》笔记
    </a></div>
      <div class="post-nav-item">
    <a href="/m%C3%97n%E7%9F%A9%E9%98%B5%E7%9A%84%E8%A1%8C%E5%88%97%E5%BC%8F/" rel="next" title="m×n矩阵的行列式">
      m×n矩阵的行列式 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%9D%E7%AD%89pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97"><span class="nav-number">2.</span> <span class="nav-text">初等pyspider操作指南</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E7%88%AC%E8%99%AB"><span class="nav-number">2.1.</span> <span class="nav-text">实现一个最简单的爬虫</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%90%AD%E5%BB%BA%E6%A1%86%E6%9E%B6"><span class="nav-number">2.1.1.</span> <span class="nav-text">搭建框架</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%88%AC%E5%8F%96%E5%86%85%E5%AE%B9"><span class="nav-number">2.1.2.</span> <span class="nav-text">爬取内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E6%9E%9C%E5%B1%95%E7%A4%BA"><span class="nav-number">2.1.3.</span> <span class="nav-text">结果展示</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CSS%E9%80%89%E6%8B%A9%E5%99%A8%E7%9A%84%E7%AE%80%E5%8D%95%E5%9B%9E%E9%A1%BE"><span class="nav-number">2.2.</span> <span class="nav-text">CSS选择器的简单回顾</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFCSS%E9%80%89%E6%8B%A9%E5%99%A8"><span class="nav-number">2.2.1.</span> <span class="nav-text">什么是CSS选择器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%93%E5%8F%96%E5%90%88%E9%80%82%E7%9A%84CSS"><span class="nav-number">2.2.2.</span> <span class="nav-text">抓取合适的CSS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">2.2.3.</span> <span class="nav-text">最简单的正则表达式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9E%84%E5%8C%96%E3%80%81%E4%BC%AA%E5%AE%8F%E6%8E%A7%E5%88%B6"><span class="nav-number">2.3.</span> <span class="nav-text">结构化、伪宏控制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%AA%E5%AE%8F%E6%8E%A7%E5%88%B6"><span class="nav-number">2.3.1.</span> <span class="nav-text">伪宏控制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8C%83%E5%BC%8F%E7%BC%96%E7%A8%8B"><span class="nav-number">2.3.2.</span> <span class="nav-text">范式编程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%81%E8%A3%85%E4%B8%8E%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="nav-number">2.4.</span> <span class="nav-text">封装与自动化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E5%88%9B%E5%BB%BA%E5%AD%90%E7%9B%AE%E5%BD%95"><span class="nav-number">2.4.1.</span> <span class="nav-text">自动化创建子目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%81%E8%A3%85%E2%80%94%E2%80%94create-table%E6%96%B9%E6%B3%95%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">2.4.2.</span> <span class="nav-text">封装——create_table方法的实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="nav-number">2.4.3.</span> <span class="nav-text">自动化创建表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E9%87%8D%E7%94%A8"><span class="nav-number">2.4.4.</span> <span class="nav-text">代码重用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A6%82%E4%BD%95DEBUG%EF%BC%9F"><span class="nav-number">2.5.</span> <span class="nav-text">如何DEBUG？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DEBUG%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">2.5.1.</span> <span class="nav-text">DEBUG是什么</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93"><span class="nav-number">2.5.2.</span> <span class="nav-text">常用方法总结</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#l-%E4%BD%BF%E7%94%A8%E5%8D%95%E6%AD%A5%E8%B0%83%E8%AF%95"><span class="nav-number">2.5.2.1.</span> <span class="nav-text">l  使用单步调试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#l-%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%B0%83%E8%AF%95"><span class="nav-number">2.5.2.2.</span> <span class="nav-text">l  使用命令行调试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#l-%E4%BD%BF%E7%94%A8%E5%89%8D%E5%90%8E%E6%8E%A5%E5%8F%A3%E8%B0%83%E8%AF%95"><span class="nav-number">2.5.2.3.</span> <span class="nav-text">l  使用前后接口调试</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%99%E5%9C%A8%E6%9C%80%E5%90%8E"><span class="nav-number">2.5.3.</span> <span class="nav-text">写在最后</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BD%A9%E8%9B%8B"><span class="nav-number">2.5.4.</span> <span class="nav-text">彩蛋</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pyspider%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="nav-number">3.</span> <span class="nav-text">Pyspider环境配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Python2%E6%A1%86%E6%9E%B6"><span class="nav-number">3.1.</span> <span class="nav-text">Python2框架</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Anaconda%E6%A1%86%E6%9E%B6"><span class="nav-number">3.2.</span> <span class="nav-text">Anaconda框架</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Demo"><span class="nav-number">3.3.</span> <span class="nav-text">Demo</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Reference"><span class="nav-number">4.</span> <span class="nav-text">Reference</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#python%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99"><span class="nav-number">4.1.</span> <span class="nav-text">python学习资料</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pyspider%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99"><span class="nav-number">4.2.</span> <span class="nav-text">pyspider学习资料</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pyspider%E5%BF%AB%E6%8D%B7%E5%90%AF%E5%8A%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">4.3.</span> <span class="nav-text">pyspider快捷启动命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%AF%E8%83%BD%E4%BC%9A%E7%94%A8%E5%88%B0%E7%9A%84%E5%AE%89%E8%A3%85%E5%8C%85"><span class="nav-number">4.4.</span> <span class="nav-text">可能会用到的安装包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%B7%E4%B9%8B%C2%B7%E9%99%84%E5%BD%95-%E4%BB%A3%E7%A0%81"><span class="nav-number">4.5.</span> <span class="nav-text">迷之·附录(代码)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%EF%BC%9A%E7%BB%93%E6%9E%84-model-for-crawl-demo%E5%8A%A0%E6%B3%A8%E9%87%8A%E7%89%88-py"><span class="nav-number">4.5.1.</span> <span class="nav-text">代码：结构_model_for_crawl_demo加注释版.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%EF%BC%9A%E5%8A%9F%E8%83%BDfor-compositesworld-%E5%A4%8D%E5%90%88%E6%9D%90%E6%96%99%E4%B8%96%E7%95%8C-%E7%88%AC%E8%99%AB%E7%A8%8B%E5%BA%8F-%E8%AF%A6%E6%B3%A8"><span class="nav-number">4.5.2.</span> <span class="nav-text">代码：功能for_compositesworld(复合材料世界)爬虫程序_详注</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%EF%BC%9A%E5%B0%81%E8%A3%85for-jeccomposites-JEC-%E4%BC%AA%E5%AE%8F%E6%8E%A7%E5%88%B6-%E8%8C%83%E5%BC%8F%E7%BC%96%E7%A8%8B"><span class="nav-number">4.5.3.</span> <span class="nav-text">代码：封装for_jeccomposites(JEC)伪宏控制__范式编程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%EF%BC%9Aforcompositesworld-%E5%A4%8D%E5%90%88%E6%9D%90%E6%96%99%E4%B8%96%E7%95%8C-%E5%9F%BA%E4%BA%8EJEC%E9%80%9A%E7%94%A8%E5%8C%96%E4%BB%A3%E7%A0%81%E6%A8%A1%E6%9D%BF-%E6%94%B9%E8%BF%9B%E7%89%88"><span class="nav-number">4.5.4.</span> <span class="nav-text">代码：forcompositesworld(复合材料世界)基于JEC通用化代码模板_改进版</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%EF%BC%9Atestpro%E9%80%9A%E8%BF%87%E8%B0%83%E7%94%A8MySQLnew%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA%E5%88%97%E8%A1%A8-demo"><span class="nav-number">4.5.5.</span> <span class="nav-text">代码：testpro通过调用MySQLnew实现自动创建列表_demo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%EF%BC%9Amysqldb-new%EF%BC%88%E5%BA%93%EF%BC%89"><span class="nav-number">4.5.6.</span> <span class="nav-text">代码：mysqldb_new（库）</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="工云"
      src="/images/stellarkey.gif">
  <p class="site-author-name" itemprop="name">工云</p>
  <div class="site-description" itemprop="description">Never stop thinking.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">64</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">34</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://vel.life/" title="Life → https:&#x2F;&#x2F;vel.life&#x2F;" rel="noopener external nofollow noreferrer" target="_blank"><i class="fas fa-star-of-life fa-fw"></i>Life</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://vel.wiki/" title="Wiki → https:&#x2F;&#x2F;vel.wiki&#x2F;" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-wikipedia-w fa-fw"></i>Wiki</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/stellarkey" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;stellarkey" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:velocfc@gmail.com" title="E-Mail → mailto:velocfc@gmail.com" rel="noopener external nofollow noreferrer" target="_blank"><i class="fas fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/huo-shu-93/" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;huo-shu-93&#x2F;" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-zhihu fa-fw"></i>知乎</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/18738090/" title="B站 → https:&#x2F;&#x2F;space.bilibili.com&#x2F;18738090&#x2F;" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-bilibili fa-fw"></i>B站</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener external nofollow noreferrer" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      云海之上
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.iszy.cc/" title="https:&#x2F;&#x2F;www.iszy.cc&#x2F;" rel="noopener external nofollow noreferrer" target="_blank">随遇而安</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://asdfv1929.github.io/" title="https:&#x2F;&#x2F;asdfv1929.github.io&#x2F;" rel="noopener external nofollow noreferrer" target="_blank">asdfv1929</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://printempw.github.io/" title="https:&#x2F;&#x2F;printempw.github.io&#x2F;" rel="noopener external nofollow noreferrer" target="_blank">PRIN BLOG</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.cfzhao.com/" title="http:&#x2F;&#x2F;www.cfzhao.com&#x2F;" rel="noopener external nofollow noreferrer" target="_blank">ZHAOYUWEI</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://hanherbert.github.io/" title="https:&#x2F;&#x2F;hanherbert.github.io&#x2F;" rel="noopener external nofollow noreferrer" target="_blank">知青</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://louieworth.github.io/" title="https:&#x2F;&#x2F;louieworth.github.io&#x2F;" rel="noopener external nofollow noreferrer" target="_blank">louieworth</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://hgen27.github.io/" title="https:&#x2F;&#x2F;hgen27.github.io&#x2F;" rel="noopener external nofollow noreferrer" target="_blank">Hgen</a>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2018 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-chart-line"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Vel</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">546k</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/lozad.js/1.14.0/lozad.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  



  <script>
  if (CONFIG.page.isPost) {
    wpac_init = window.wpac_init || [];
    wpac_init.push({
      widget: 'Rating',
      id    : 27281,
      el    : 'wpac-rating',
      color : 'fc6423'
    });
    (function() {
      if ('WIDGETPACK_LOADED' in window) return;
      WIDGETPACK_LOADED = true;
      var mc = document.createElement('script');
      mc.type = 'text/javascript';
      mc.async = true;
      mc.src = '//embed.widgetpack.com/widget.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
    })();
  }
  </script>

  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  

  
  <script src="//unpkg.com/quicklink@2.2.0/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://stellarkey.github.io/Pyspider%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/',]
      });
      });
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>
